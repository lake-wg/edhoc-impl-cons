<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Implementation Considerations for Ephemeral Diffie-Hellman Over COSE (EDHOC)</title>
<meta content="Marco Tiloca" name="author">
<meta content="
       This document provides considerations for guiding the implementation of the authenticated key exchange protocol Ephemeral Diffie-Hellman Over COSE (EDHOC). 
    " name="description">
<meta content="xml2rfc 3.31.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-lake-edhoc-impl-cons-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.31.0
    Python 3.12.12
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.2.1
    Jinja2 3.1.6
    lxml 6.0.2
    platformdirs 4.5.1
    pycountry 24.6.1
    PyYAML 6.0.3
    requests 2.32.5
    wcwidth 0.3.0
-->
<link href="draft-ietf-lake-edhoc-impl-cons.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
  border-left: 2px var(--pilcrow-strong) solid;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow, a.pilcrow:focus {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Implementation Considerations for EDHOC</td>
<td class="right">February 2026</td>
</tr></thead>
<tfoot><tr>
<td class="left">Tiloca</td>
<td class="center">Expires 14 August 2026</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">LAKE Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-lake-edhoc-impl-cons-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2026-02-10" class="published">10 February 2026</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2026-08-14">14 August 2026</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Tiloca</div>
<div class="org">RISE AB</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Implementation Considerations for Ephemeral Diffie-Hellman Over COSE (EDHOC)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document provides considerations for guiding the implementation of the authenticated key exchange protocol Ephemeral Diffie-Hellman Over COSE (EDHOC).<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Discussion of this document takes place on the
    Lightweight Authenticated Key Exchange Working Group mailing list (lake@ietf.org),
    which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/lake/">https://mailarchive.ietf.org/arch/browse/lake/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/lake-wg/edhoc-impl-cons">https://github.com/lake-wg/edhoc-impl-cons</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 14 August 2026.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2026 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-handling-of-invalid-edhoc-s" class="internal xref">Handling of Invalid EDHOC Sessions and Application Keys</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-edhoc-sessions-become-inval" class="internal xref">EDHOC Sessions Become Invalid</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-application-keys-become-inv" class="internal xref">Application Keys Become Invalid</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="auto internal xref">2.3</a>.  <a href="#name-application-keys-or-bound-a" class="internal xref">Application Keys or Bound Access Rights Become Invalid</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-trust-policies-for-learning" class="internal xref">Trust Policies for Learning New Authentication Credentials</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-trust-policy-learning" class="internal xref">Trust Policy LEARNING</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-trust-policy-no-learning" class="internal xref">Trust Policy NO-LEARNING</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-enforcement-of-trust-polici" class="internal xref">Enforcement of Trust Policies in Specific Scenarios</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.1">
                    <p id="section-toc.1-1.3.2.3.2.1.1"><a href="#section-3.3.1" class="auto internal xref">3.3.1</a>.  <a href="#name-in-the-edhoc-and-oscore-pro" class="internal xref">In the EDHOC and OSCORE Profile of ACE</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.2">
                    <p id="section-toc.1-1.3.2.3.2.2.1"><a href="#section-3.3.2" class="auto internal xref">3.3.2</a>.  <a href="#name-in-the-lightweight-authoriz" class="internal xref">In the Lightweight Authorization using EDHOC (ELA) Procedure</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-side-processing-of-incoming" class="internal xref">Side Processing of Incoming EDHOC Messages</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-edhoc-message_1" class="internal xref">EDHOC message_1</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-edhoc-message_4" class="internal xref">EDHOC message_4</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-edhoc-message_2-and-message" class="internal xref">EDHOC message_2 and message_3</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.1">
                    <p id="section-toc.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="auto internal xref">4.3.1</a>.  <a href="#name-pre-verification-side-proce" class="internal xref">Pre-Verification Side Processing</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.2">
                    <p id="section-toc.1-1.4.2.3.2.2.1"><a href="#section-4.3.2" class="auto internal xref">4.3.2</a>.  <a href="#name-post-verification-side-proc" class="internal xref">Post-Verification Side Processing</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.3">
                    <p id="section-toc.1-1.4.2.3.2.3.1"><a href="#section-4.3.3" class="auto internal xref">4.3.3</a>.  <a href="#name-flowcharts" class="internal xref">Flowcharts</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-consistency-checks-of-authe" class="internal xref">Consistency Checks of Authentication Credentials from ID_CRED and EAD Items</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-using-edhoc-over-coap-with-" class="internal xref">Using EDHOC over CoAP with Block-Wise</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-notation" class="internal xref">Notation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-pre-requirements-for-the-ed" class="internal xref">Pre-requirements for the EDHOC + OSCORE Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-effectively-using-block-wis" class="internal xref">Effectively Using Block-Wise</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-operational-considerations" class="internal xref">Operational Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-assessing-the-correctness-o" class="internal xref">Assessing the Correctness of Implementations</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-foreseen-advanced-processin" class="internal xref">Foreseen Advanced Processing of Incoming EDHOC message_1</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-document-updates" class="internal xref">Document Updates</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#appendix-B.1" class="auto internal xref">B.1</a>.  <a href="#name-version-05-to-06" class="internal xref">Version -05 to -06</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#appendix-B.2" class="auto internal xref">B.2</a>.  <a href="#name-version-04-to-05" class="internal xref">Version -04 to -05</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.3">
                <p id="section-toc.1-1.11.2.3.1"><a href="#appendix-B.3" class="auto internal xref">B.3</a>.  <a href="#name-version-03-to-04" class="internal xref">Version -03 to -04</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.4">
                <p id="section-toc.1-1.11.2.4.1"><a href="#appendix-B.4" class="auto internal xref">B.4</a>.  <a href="#name-version-02-to-03" class="internal xref">Version -02 to -03</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.5">
                <p id="section-toc.1-1.11.2.5.1"><a href="#appendix-B.5" class="auto internal xref">B.5</a>.  <a href="#name-version-01-to-02" class="internal xref">Version -01 to -02</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.6">
                <p id="section-toc.1-1.11.2.6.1"><a href="#appendix-B.6" class="auto internal xref">B.6</a>.  <a href="#name-version-00-to-01" class="internal xref">Version -00 to -01</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-D" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Ephemeral Diffie-Hellman Over COSE (EDHOC) <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span> is a lightweight authenticated key exchange protocol, especially intended for use in constrained scenarios.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">During the development of EDHOC, a number of side topics were raised and discussed, as emerging from reviews of the protocol latest design and from implementation activities. These topics were identified as strongly pertaining to the implementation of EDHOC rather than to the protocol in itself. Hence, they are not discussed in <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>, which rightly focuses on specifying the actual protocol.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">At the same time, implementers of an application using the EDHOC protocol or of an "EDHOC library" enabling its use cannot simply ignore such topics and will have to take them into account throughout their implementation work.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">In order to prevent multiple, independent re-discoveries and assessments of those topics, as well as to facilitate and guide implementation activities, this document collects such topics and discusses them through considerations about the implementation of EDHOC. At a high-level, the topics in question are summarized below:<a href="#section-1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-5.1">
          <p id="section-1-5.1.1">Handling of completed EDHOC sessions when they become invalid and of application keys derived from an EDHOC session when those become invalid. This topic is discussed in <a href="#sec-session-handling" class="auto internal xref">Section 2</a>.<a href="#section-1-5.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-5.2">
          <p id="section-1-5.2.1">Enforcement of different trust policies, with respect to learning new authentication credentials during an execution of EDHOC. This topic is discussed in <a href="#sec-trust-models" class="auto internal xref">Section 3</a>.<a href="#section-1-5.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-5.3">
          <p id="section-1-5.3.1">Branched-off side processing of incoming EDHOC messages, with particular reference to: i) fetching and validation of authentication credentials; and ii) processing of External Authorization Data (EAD) items, which in turn might play a role in the fetching and validation of authentication credentials. This topic is discussed in <a href="#sec-message-side-processing" class="auto internal xref">Section 4</a>.<a href="#section-1-5.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-5.4">
          <p id="section-1-5.4.1">Effectively using EDHOC over the Constrained Application Protocol (CoAP) <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span> in combination with Block-wise transfers for CoAP <span>[<a href="#RFC7959" class="cite xref">RFC7959</a>]</span>, possibly together with the optimized EDHOC execution workflow defined in <span>[<a href="#RFC9668" class="cite xref">RFC9668</a>]</span>. This topic is discussed in <a href="#sec-block-wise" class="auto internal xref">Section 5</a>.<a href="#section-1-5.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<div id="terminology">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The reader is expected to be familiar with terms and concepts related to the EDHOC protocol <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>, (CoAP) <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>, and Block-wise transfers for CoAP <span>[<a href="#RFC7959" class="cite xref">RFC7959</a>]</span>.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-session-handling">
<section id="section-2">
      <h2 id="name-handling-of-invalid-edhoc-s">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-handling-of-invalid-edhoc-s" class="section-name selfRef">Handling of Invalid EDHOC Sessions and Application Keys</a>
      </h2>
<p id="section-2-1">This section considers the most common situation where, given a certain peer, only the application at that peer has visibility and control of both:<a href="#section-2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-2.1">
          <p id="section-2-2.1.1">The EDHOC sessions at that peer; and<a href="#section-2-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-2.2">
          <p id="section-2-2.2.1">The application keys for that application at that peer, including the knowledge of whether they have been derived from an EDHOC session, i.e., by means of the EDHOC_Exporter interface after the successful completion of an execution of EDHOC (see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-4.2" class="relref">Section 4.2</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>).<a href="#section-2-2.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-2-3">Building on the above, the following expands on three relevant cases concerning the handling of EDHOC sessions and application keys, in the event that any of those becomes invalid.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">To provide more concrete guidance, the following considers the case where "applications keys" stands for the keying material and parameters that compose a Security Context for the security protocol Object Security for Constrained RESTful Environments (OSCORE) <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, i.e., when specifically those application keys are derived from an EDHOC session (see <span><a href="https://rfc-editor.org/rfc/rfc9528#appendix-A.1" class="relref">Appendix A.1</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>).<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5">Nevertheless, the same considerations are applicable if EDHOC is used to derive other application keys, e.g., when used to key different security protocols than OSCORE or to provide the application with secure values that are bound to an EDHOC session.<a href="#section-2-5" class="pilcrow">¶</a></p>
<div id="sec-session-invalid">
<section id="section-2.1">
        <h3 id="name-edhoc-sessions-become-inval">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-edhoc-sessions-become-inval" class="section-name selfRef">EDHOC Sessions Become Invalid</a>
        </h3>
<p id="section-2.1-1">The application at a peer P may have learned that a completed EDHOC session S has to be invalidated. When S is marked as invalid, the application at P purges S and deletes each set of application keys (e.g., the OSCORE Security Context) that was generated from S.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">Then, the application runs a new execution of the EDHOC protocol with the other peer. Upon successfully completing the EDHOC execution, the two peers derive and install a new set of application keys from this latest EDHOC session.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1-3">The flowchart in <a href="#fig-flowchart-session-invalid" class="auto internal xref">Figure 1</a> shows the handling of an EDHOC session that has become invalid.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<span id="name-handling-of-an-edhoc-sessio"></span><div id="fig-flowchart-session-invalid">
<figure id="figure-1">
          <div id="section-2.1-4.1">
            <div class="alignCenter art-svg artwork" id="section-2.1-4.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="80" width="568" viewBox="0 0 568 80" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 72,48 L 96,48" fill="none" stroke="black"></path>
                <path d="M 312,48 L 336,48" fill="none" stroke="black"></path>
                <path d="M 400,48 L 424,48" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="432,48 420,42.4 420,53.6" fill="black" transform="rotate(0,424,48)"></polygon>
                <polygon class="arrowhead" points="344,48 332,42.4 332,53.6" fill="black" transform="rotate(0,336,48)"></polygon>
                <polygon class="arrowhead" points="104,48 92,42.4 92,53.6" fill="black" transform="rotate(0,96,48)"></polygon>
                <g class="text">
                  <text x="32" y="36">Invalid</text>
                  <text x="132" y="36">Delete</text>
                  <text x="176" y="36">the</text>
                  <text x="216" y="36">EDHOC</text>
                  <text x="272" y="36">session</text>
                  <text x="368" y="36">Rerun</text>
                  <text x="460" y="36">Derive</text>
                  <text x="504" y="36">and</text>
                  <text x="24" y="52">EDHOC</text>
                  <text x="120" y="52">and</text>
                  <text x="152" y="52">the</text>
                  <text x="216" y="52">application</text>
                  <text x="284" y="52">keys</text>
                  <text x="368" y="52">EDHOC</text>
                  <text x="464" y="52">install</text>
                  <text x="512" y="52">new</text>
                  <text x="32" y="68">session</text>
                  <text x="136" y="68">derived</text>
                  <text x="188" y="68">from</text>
                  <text x="220" y="68">it</text>
                  <text x="480" y="68">application</text>
                  <text x="548" y="68">keys</text>
                </g>
              </svg><a href="#section-2.1-4.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-handling-of-an-edhoc-sessio" class="selfRef">Handling of an EDHOC Session that Has Become Invalid.</a>
          </figcaption></figure>
</div>
<p id="section-2.1-5">An EDHOC session may have become invalid, for example, because an authentication credential CRED_X has expired, or because the peer P has learned from a trusted source that CRED_X has been revoked. This effectively invalidates CRED_X, and therefore also invalidates any EDHOC session where CRED_X was used as authentication credential associated with either peer in the session (i.e., P itself or the other peer). In such a case, the application at P has to additionally delete CRED_X and any stored, corresponding credential identifier.<a href="#section-2.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-keys-invalid">
<section id="section-2.2">
        <h3 id="name-application-keys-become-inv">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-application-keys-become-inv" class="section-name selfRef">Application Keys Become Invalid</a>
        </h3>
<p id="section-2.2-1">The application at a peer P may have learned that a set of application keys is not safe to use anymore. When such a set is specifically an OSCORE Security Context, the application may have learned that from the OSCORE library used or from an OSCORE layer that takes part in the communication stack.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">A current set SET of application keys shared with another peer can become unsafe to use, for example, due to the following reasons:<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2-3.1">
            <p id="section-2.2-3.1.1">SET has reached a pre-determined expiration time;<a href="#section-2.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.2-3.2">
            <p id="section-2.2-3.2.1">SET has been established to use for an amount of time that is now elapsed, according to enforced application policies; or<a href="#section-2.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.2-3.3">
            <p id="section-2.2-3.3.1">Some elements of SET have been used enough times to approach cryptographic limits that should not be passed, e.g., according to the properties of the security algorithms specifically used. With particular reference to an OSCORE Security Context, such limits are discussed in <span>[<a href="#I-D.ietf-core-oscore-key-limits" class="cite xref">I-D.ietf-core-oscore-key-limits</a>]</span>.<a href="#section-2.2-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.2-4">When this happens, the application at the peer P proceeds as follows:<a href="#section-2.2-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.2-5">
<li id="section-2.2-5.1">
            <p id="section-2.2-5.1.1">If the following conditions both hold, then the application moves to Step 2. Otherwise, it moves to Step 3.<a href="#section-2.2-5.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2-5.1.2.1">
                <p id="section-2.2-5.1.2.1.1">Let us define S as the EDHOC session from which the peer P has derived SET or the eldest SET's ancestor set of application keys. Then, since the completion of S with the other peer, the application at P has received from the other peer and successfully verified at least one message protected with any set of application keys derived from S. That is, P has persisted S (see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-5.4.2" class="relref">Section 5.4.2</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>).<a href="#section-2.2-5.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2-5.1.2.2">
                <p id="section-2.2-5.1.2.2.1">The peer P supports a key update protocol, as an alternative to performing a new execution of EDHOC with the other peer. When SET is an OSCORE Security Context, the key update protocol supported by the peer P can be KUDOS <span>[<a href="#I-D.ietf-core-oscore-key-update" class="cite xref">I-D.ietf-core-oscore-key-update</a>]</span>.<a href="#section-2.2-5.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li id="section-2.2-5.2">
            <p id="section-2.2-5.2.1">The application at P runs the key update protocol mentioned at Step 1 with the other peer, in order to update SET. When SET is an OSCORE Security Context, the application at P can run the key update protocol KUDOS with the other peer.<a href="#section-2.2-5.2.1" class="pilcrow">¶</a></p>
<p id="section-2.2-5.2.2">
If the key update protocol terminates successfully, the updated application keys are installed and no further actions are taken. Otherwise, the application at P moves to Step 3.<a href="#section-2.2-5.2.2" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.2-5.3">
            <p id="section-2.2-5.3.1">The application at the peer P performs the following actions:<a href="#section-2.2-5.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2-5.3.2.1">
                <p id="section-2.2-5.3.2.1.1">It deletes SET.<a href="#section-2.2-5.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2-5.3.2.2">
                <p id="section-2.2-5.3.2.2.1">It deletes the EDHOC session from which SET was generated, or from which the eldest SET's ancestor set of application keys was generated before any key update occurred (e.g., by means of the EDHOC_KeyUpdate interface defined in <span><a href="https://rfc-editor.org/rfc/rfc9528#appendix-H" class="relref">Appendix H</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span> or other key update methods).<a href="#section-2.2-5.3.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2-5.3.2.3">
                <p id="section-2.2-5.3.2.3.1">It runs a new execution of the EDHOC protocol with the other peer. Upon successfully completing the EDHOC execution, the two peers derive and install a new set of application keys from this latest EDHOC session.<a href="#section-2.2-5.3.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ol>
<p id="section-2.2-6">The flowchart in <a href="#fig-flowchart-keys-invalid" class="auto internal xref">Figure 2</a> shows the handling of a set of application keys that has become invalid. In particular, it assumes such a set to be an OSCORE Security Context and the key update protocol to be KUDOS.<a href="#section-2.2-6" class="pilcrow">¶</a></p>
<span id="name-handling-of-a-set-of-applic"></span><div id="fig-flowchart-keys-invalid">
<figure id="figure-2">
          <div id="section-2.2-7.1">
            <div class="alignCenter art-svg artwork" id="section-2.2-7.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="608" width="568" viewBox="0 0 568 608" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 24,64 L 24,96" fill="none" stroke="black"></path>
                <path d="M 24,192 L 24,224" fill="none" stroke="black"></path>
                <path d="M 24,304 L 24,336" fill="none" stroke="black"></path>
                <path d="M 24,400 L 24,432" fill="none" stroke="black"></path>
                <path d="M 24,512 L 24,544" fill="none" stroke="black"></path>
                <path d="M 240,176 L 240,272" fill="none" stroke="black"></path>
                <path d="M 312,176 L 312,480" fill="none" stroke="black"></path>
                <path d="M 472,176 L 472,208" fill="none" stroke="black"></path>
                <path d="M 144,128 L 176,128" fill="none" stroke="black"></path>
                <path d="M 408,128 L 440,128" fill="none" stroke="black"></path>
                <path d="M 96,272 L 240,272" fill="none" stroke="black"></path>
                <path d="M 96,480 L 312,480" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="480,208 468,202.4 468,213.6" fill="black" transform="rotate(90,472,208)"></polygon>
                <polygon class="arrowhead" points="448,128 436,122.4 436,133.6" fill="black" transform="rotate(0,440,128)"></polygon>
                <polygon class="arrowhead" points="320,176 308,170.4 308,181.6" fill="black" transform="rotate(270,312,176)"></polygon>
                <polygon class="arrowhead" points="248,176 236,170.4 236,181.6" fill="black" transform="rotate(270,240,176)"></polygon>
                <polygon class="arrowhead" points="184,128 172,122.4 172,133.6" fill="black" transform="rotate(0,176,128)"></polygon>
                <polygon class="arrowhead" points="32,544 20,538.4 20,549.6" fill="black" transform="rotate(90,24,544)"></polygon>
                <polygon class="arrowhead" points="32,432 20,426.4 20,437.6" fill="black" transform="rotate(90,24,432)"></polygon>
                <polygon class="arrowhead" points="32,336 20,330.4 20,341.6" fill="black" transform="rotate(90,24,336)"></polygon>
                <polygon class="arrowhead" points="32,224 20,218.4 20,229.6" fill="black" transform="rotate(90,24,224)"></polygon>
                <polygon class="arrowhead" points="32,96 20,90.4 20,101.6" fill="black" transform="rotate(90,24,96)"></polygon>
                <g class="text">
                  <text x="32" y="36">Invalid</text>
                  <text x="112" y="36">application</text>
                  <text x="180" y="36">keys</text>
                  <text x="156" y="116">NO</text>
                  <text x="16" y="132">Are</text>
                  <text x="48" y="132">the</text>
                  <text x="212" y="132">Delete</text>
                  <text x="256" y="132">the</text>
                  <text x="320" y="132">application</text>
                  <text x="472" y="132">Rerun</text>
                  <text x="48" y="148">application</text>
                  <text x="116" y="148">keys</text>
                  <text x="204" y="148">keys</text>
                  <text x="240" y="148">and</text>
                  <text x="272" y="148">the</text>
                  <text x="312" y="148">EDHOC</text>
                  <text x="368" y="148">session</text>
                  <text x="472" y="148">EDHOC</text>
                  <text x="44" y="164">persisted?</text>
                  <text x="48" y="212">YES</text>
                  <text x="428" y="244">Derive</text>
                  <text x="472" y="244">and</text>
                  <text x="520" y="244">install</text>
                  <text x="12" y="260">Is</text>
                  <text x="48" y="260">KUDOS</text>
                  <text x="108" y="260">NO</text>
                  <text x="416" y="260">new</text>
                  <text x="480" y="260">application</text>
                  <text x="548" y="260">keys</text>
                  <text x="44" y="276">supported?</text>
                  <text x="48" y="324">YES</text>
                  <text x="16" y="372">Run</text>
                  <text x="56" y="372">KUDOS</text>
                  <text x="16" y="468">Has</text>
                  <text x="56" y="468">KUDOS</text>
                  <text x="108" y="468">NO</text>
                  <text x="44" y="484">succeeded?</text>
                  <text x="48" y="532">YES</text>
                  <text x="32" y="580">Install</text>
                  <text x="80" y="580">the</text>
                  <text x="128" y="580">updated</text>
                  <text x="48" y="596">application</text>
                  <text x="116" y="596">keys</text>
                </g>
              </svg><a href="#section-2.2-7.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-handling-of-a-set-of-applic" class="selfRef">Handling of a Set of Application Keys that Has Become Invalid.</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="sec-keys-token-invalid">
<section id="section-2.3">
        <h3 id="name-application-keys-or-bound-a">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-application-keys-or-bound-a" class="section-name selfRef">Application Keys or Bound Access Rights Become Invalid</a>
        </h3>
<p id="section-2.3-1">The following considers two peers that use the ACE framework for authentication and authorization in constrained environments <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span> and specifically the EDHOC and OSCORE profile of ACE defined in <span>[<a href="#I-D.ietf-ace-edhoc-oscore-profile" class="cite xref">I-D.ietf-ace-edhoc-oscore-profile</a>]</span>.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3-2">When doing so, one of the two peers acts as ACE resource server (RS) hosting protected resources. The other peer acts as ACE client and requests an access token from an ACE authorization server (AS) that is in a trust relationship with the RS. The access token specifies access rights for accessing protected resources at the RS as well as the public authentication credential of the client, namely AUTH_CRED_C.<a href="#section-2.3-2" class="pilcrow">¶</a></p>
<p id="section-2.3-3">After that, C uploads the access token to the RS, by means of an EAD item included in an EDHOC message during the EDHOC execution (see below). Alternatively, the AS can upload the access token to the RS on behalf of the client, as per the alternative Short Distribution Chain (SDC) workflow defined in <span>[<a href="#I-D.ietf-ace-workflow-and-params" class="cite xref">I-D.ietf-ace-workflow-and-params</a>]</span>.<a href="#section-2.3-3" class="pilcrow">¶</a></p>
<p id="section-2.3-4">Consistent with the EDHOC and OSCORE profile of ACE, the two peers run EDHOC in order to specifically derive an OSCORE Security Context as their shared set of application keys (see <span><a href="https://rfc-editor.org/rfc/rfc9528#appendix-A.1" class="relref">Appendix A.1</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>). At the RS, the access token is bound to the successfully completed EDHOC session and to the established OSCORE Security Context.<a href="#section-2.3-4" class="pilcrow">¶</a></p>
<p id="section-2.3-5">After that, the peer acting as ACE client can access the protected resources hosted at the other peer acting as RS, according to the access rights specified in the access token. The communications between the two peers are protected by means of the established OSCORE Security Context.<a href="#section-2.3-5" class="pilcrow">¶</a></p>
<p id="section-2.3-6">Later on, the application at one of the two peers P may have learned that the established OSCORE Security Context CTX is not safe to use anymore, e.g., from the OSCORE library used or from an OSCORE layer that takes part in the communication stack. The reasons that make CTX not safe to use anymore are the same ones discussed in <a href="#sec-keys-invalid" class="auto internal xref">Section 2.2</a> when considering a set of application keys in general, plus the event that the access token bound to CTX becomes invalid (e.g., it has expired or it has been revoked).<a href="#section-2.3-6" class="pilcrow">¶</a></p>
<p id="section-2.3-7">When this happens, the application at the peer P proceeds as follows.<a href="#section-2.3-7" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.3-8">
<li id="section-2.3-8.1">
            <p id="section-2.3-8.1.1">If the following conditions both hold, then the application moves to Step 2. Otherwise, it moves to Step 3:<a href="#section-2.3-8.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3-8.1.2.1">
                <p id="section-2.3-8.1.2.1.1">The access token is still believed to be valid. That is, it has not expired yet and the peer P is not aware that it has been revoked.<a href="#section-2.3-8.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.3-8.1.2.2">
                <p id="section-2.3-8.1.2.2.1">Let us define S as the EDHOC session from which the peer P has derived CTX or the eldest CTX's ancestor OSCORE Security Context. Then, since the completion of S with the other peer, the application at P has received from the other peer and successfully verified at least one message protected with any set of application keys derived from S. That is, P has persisted S (see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-5.4.2" class="relref">Section 5.4.2</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>).<a href="#section-2.3-8.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li id="section-2.3-8.2">
            <p id="section-2.3-8.2.1">If the peer P supports the key update protocol KUDOS <span>[<a href="#I-D.ietf-core-oscore-key-update" class="cite xref">I-D.ietf-core-oscore-key-update</a>]</span>, then P runs KUDOS with the other peer, in order to update CTX. If the execution of KUDOS terminates successfully, the updated OSCORE Security Context is installed and no further actions are taken.<a href="#section-2.3-8.2.1" class="pilcrow">¶</a></p>
<p id="section-2.3-8.2.2">
If the execution of KUDOS does not terminate successfully or if the peer P does not support KUDOS altogether, then the application at P moves to Step 3.<a href="#section-2.3-8.2.2" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.3-8.3">
            <p id="section-2.3-8.3.1">The application at the peer P performs the following actions.<a href="#section-2.3-8.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3-8.3.2.1">
                <p id="section-2.3-8.3.2.1.1">If the access token is not believed to be valid anymore, the peer P deletes all the EDHOC sessions associated with the access token as well as the OSCORE Security Context derived from each of those sessions.<a href="#section-2.3-8.3.2.1.1" class="pilcrow">¶</a></p>
<p id="section-2.3-8.3.2.1.2">
Note that, when specifically considering the EDHOC and OSCORE profile of ACE, an access token is associated with at most one EDHOC session (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-edhoc-oscore-profile-09#section-4.2" class="relref">Section 4.2</a> of [<a href="#I-D.ietf-ace-edhoc-oscore-profile" class="cite xref">I-D.ietf-ace-edhoc-oscore-profile</a>]</span>).<a href="#section-2.3-8.3.2.1.2" class="pilcrow">¶</a></p>
<p id="section-2.3-8.3.2.1.3">
If the peer P acted as ACE client, then P obtains from the ACE AS a new access token, which is uploaded to the other peer acting as ACE RS.<a href="#section-2.3-8.3.2.1.3" class="pilcrow">¶</a></p>
<p id="section-2.3-8.3.2.1.4">
Finally, the application at P moves to Step 4.<a href="#section-2.3-8.3.2.1.4" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.3-8.3.2.2">
                <p id="section-2.3-8.3.2.2.1">If the access token is valid while the OSCORE Security Context CTX is not, then the peer P deletes CTX.<a href="#section-2.3-8.3.2.2.1" class="pilcrow">¶</a></p>
<p id="section-2.3-8.3.2.2.2">
After that, the peer P deletes the EDHOC session from which CTX was generated, or from which the eldest CTX's ancestor OSCORE Security Context was generated before any key update occurred (e.g., by means of KUDOS or other key update methods).<a href="#section-2.3-8.3.2.2.2" class="pilcrow">¶</a></p>
<p id="section-2.3-8.3.2.2.3">
Finally, the application at P moves to Step 4.<a href="#section-2.3-8.3.2.2.3" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li id="section-2.3-8.4">
            <p id="section-2.3-8.4.1">The peer P runs a new execution of the EDHOC protocol with the other peer. Upon successfully completing the EDHOC execution, the two peers derive and install a new OSCORE Security Context from this latest EDHOC session.<a href="#section-2.3-8.4.1" class="pilcrow">¶</a></p>
<p id="section-2.3-8.4.2">
At the RS, the access token is bound to this latest EDHOC session and the newly established OSCORE Security Context.<a href="#section-2.3-8.4.2" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-2.3-9">The flowchart in <a href="#fig-flowchart-keys-token-invalid" class="auto internal xref">Figure 3</a> shows the handling of an access token or of a set of application keys that have become invalid, when using the EDHOC and OSCORE profile of the ACE framework.<a href="#section-2.3-9" class="pilcrow">¶</a></p>
<span id="name-handling-of-an-access-token"></span><div id="fig-flowchart-keys-token-invalid">
<figure id="figure-3">
          <div id="section-2.3-10.1">
            <div class="alignCenter art-svg artwork" id="section-2.3-10.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="912" width="576" viewBox="0 0 576 912" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 24,96 L 24,128" fill="none" stroke="black"></path>
                <path d="M 24,224 L 24,288" fill="none" stroke="black"></path>
                <path d="M 24,368 L 24,400" fill="none" stroke="black"></path>
                <path d="M 24,496 L 24,528" fill="none" stroke="black"></path>
                <path d="M 24,608 L 24,640" fill="none" stroke="black"></path>
                <path d="M 24,704 L 24,736" fill="none" stroke="black"></path>
                <path d="M 24,816 L 24,848" fill="none" stroke="black"></path>
                <path d="M 264,496 L 264,576" fill="none" stroke="black"></path>
                <path d="M 336,496 L 336,784" fill="none" stroke="black"></path>
                <path d="M 504,208 L 504,448" fill="none" stroke="black"></path>
                <path d="M 560,160 L 560,576" fill="none" stroke="black"></path>
                <path d="M 112,160 L 144,160" fill="none" stroke="black"></path>
                <path d="M 336,160 L 352,160" fill="none" stroke="black"></path>
                <path d="M 456,160 L 472,160" fill="none" stroke="black"></path>
                <path d="M 536,160 L 560,160" fill="none" stroke="black"></path>
                <path d="M 144,448 L 184,448" fill="none" stroke="black"></path>
                <path d="M 456,448 L 504,448" fill="none" stroke="black"></path>
                <path d="M 96,576 L 264,576" fill="none" stroke="black"></path>
                <path d="M 96,784 L 336,784" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="568,576 556,570.4 556,581.6" fill="black" transform="rotate(90,560,576)"></polygon>
                <polygon class="arrowhead" points="512,208 500,202.4 500,213.6" fill="black" transform="rotate(270,504,208)"></polygon>
                <polygon class="arrowhead" points="480,160 468,154.4 468,165.6" fill="black" transform="rotate(0,472,160)"></polygon>
                <polygon class="arrowhead" points="360,160 348,154.4 348,165.6" fill="black" transform="rotate(0,352,160)"></polygon>
                <polygon class="arrowhead" points="344,496 332,490.4 332,501.6" fill="black" transform="rotate(270,336,496)"></polygon>
                <polygon class="arrowhead" points="272,496 260,490.4 260,501.6" fill="black" transform="rotate(270,264,496)"></polygon>
                <polygon class="arrowhead" points="192,448 180,442.4 180,453.6" fill="black" transform="rotate(0,184,448)"></polygon>
                <polygon class="arrowhead" points="152,160 140,154.4 140,165.6" fill="black" transform="rotate(0,144,160)"></polygon>
                <polygon class="arrowhead" points="32,848 20,842.4 20,853.6" fill="black" transform="rotate(90,24,848)"></polygon>
                <polygon class="arrowhead" points="32,736 20,730.4 20,741.6" fill="black" transform="rotate(90,24,736)"></polygon>
                <polygon class="arrowhead" points="32,640 20,634.4 20,645.6" fill="black" transform="rotate(90,24,640)"></polygon>
                <polygon class="arrowhead" points="32,528 20,522.4 20,533.6" fill="black" transform="rotate(90,24,528)"></polygon>
                <polygon class="arrowhead" points="32,400 20,394.4 20,405.6" fill="black" transform="rotate(90,24,400)"></polygon>
                <polygon class="arrowhead" points="32,288 20,282.4 20,293.6" fill="black" transform="rotate(90,24,288)"></polygon>
                <polygon class="arrowhead" points="32,128 20,122.4 20,133.6" fill="black" transform="rotate(90,24,128)"></polygon>
                <g class="text">
                  <text x="32" y="36">Invalid</text>
                  <text x="92" y="36">access</text>
                  <text x="144" y="36">token</text>
                  <text x="44" y="52">specifying</text>
                  <text x="140" y="52">AUTH_CRED_C,</text>
                  <text x="12" y="68">or</text>
                  <text x="56" y="68">invalid</text>
                  <text x="136" y="68">application</text>
                  <text x="204" y="68">keys</text>
                  <text x="124" y="148">NO</text>
                  <text x="12" y="164">Is</text>
                  <text x="40" y="164">the</text>
                  <text x="180" y="164">Delete</text>
                  <text x="224" y="164">the</text>
                  <text x="284" y="164">associated</text>
                  <text x="388" y="164">Obtain</text>
                  <text x="432" y="164">and</text>
                  <text x="504" y="164">Rerun</text>
                  <text x="28" y="180">access</text>
                  <text x="80" y="180">token</text>
                  <text x="176" y="180">EDHOC</text>
                  <text x="236" y="180">sessions</text>
                  <text x="288" y="180">and</text>
                  <text x="388" y="180">upload</text>
                  <text x="424" y="180">a</text>
                  <text x="504" y="180">EDHOC</text>
                  <text x="24" y="196">still</text>
                  <text x="84" y="196">believed</text>
                  <text x="168" y="196">the</text>
                  <text x="232" y="196">application</text>
                  <text x="300" y="196">keys</text>
                  <text x="376" y="196">new</text>
                  <text x="420" y="196">access</text>
                  <text x="12" y="212">to</text>
                  <text x="36" y="212">be</text>
                  <text x="76" y="212">valid?</text>
                  <text x="184" y="212">derived</text>
                  <text x="236" y="212">from</text>
                  <text x="280" y="212">those</text>
                  <text x="384" y="212">token</text>
                  <text x="48" y="276">YES</text>
                  <text x="16" y="324">The</text>
                  <text x="80" y="324">application</text>
                  <text x="148" y="324">keys</text>
                  <text x="16" y="340">are</text>
                  <text x="48" y="340">not</text>
                  <text x="88" y="340">valid</text>
                  <text x="144" y="340">anymore</text>
                  <text x="16" y="436">Are</text>
                  <text x="48" y="436">the</text>
                  <text x="156" y="436">NO</text>
                  <text x="48" y="452">application</text>
                  <text x="116" y="452">keys</text>
                  <text x="220" y="452">Delete</text>
                  <text x="264" y="452">the</text>
                  <text x="328" y="452">application</text>
                  <text x="396" y="452">keys</text>
                  <text x="432" y="452">and</text>
                  <text x="44" y="468">persisted?</text>
                  <text x="208" y="468">the</text>
                  <text x="268" y="468">associated</text>
                  <text x="336" y="468">EDHOC</text>
                  <text x="392" y="468">session</text>
                  <text x="48" y="516">YES</text>
                  <text x="12" y="564">Is</text>
                  <text x="48" y="564">KUDOS</text>
                  <text x="124" y="564">NO</text>
                  <text x="44" y="580">supported?</text>
                  <text x="452" y="612">Derive</text>
                  <text x="496" y="612">and</text>
                  <text x="544" y="612">install</text>
                  <text x="48" y="628">YES</text>
                  <text x="424" y="628">new</text>
                  <text x="488" y="628">application</text>
                  <text x="556" y="628">keys</text>
                  <text x="16" y="676">Run</text>
                  <text x="56" y="676">KUDOS</text>
                  <text x="16" y="772">Has</text>
                  <text x="56" y="772">KUDOS</text>
                  <text x="124" y="772">NO</text>
                  <text x="44" y="788">succeeded?</text>
                  <text x="48" y="836">YES</text>
                  <text x="32" y="884">Install</text>
                  <text x="80" y="884">the</text>
                  <text x="128" y="884">updated</text>
                  <text x="48" y="900">application</text>
                  <text x="116" y="900">keys</text>
                </g>
              </svg><a href="#section-2.3-10.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-handling-of-an-access-token" class="selfRef">Handling of an Access Token or of a Set of Application Keys that Have Become Invalid.</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="sec-trust-models">
<section id="section-3">
      <h2 id="name-trust-policies-for-learning">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-trust-policies-for-learning" class="section-name selfRef">Trust Policies for Learning New Authentication Credentials</a>
      </h2>
<p id="section-3-1">A peer P relies on authentication credentials associated with other peers, in order to authenticate those peers when running EDHOC with them.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">There are different ways for P to acquire an authentication credential CRED associated with another peer. For example, CRED can be supplied to P out-of-band by a trusted provider.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">Alternatively, CRED can be specified by the other peer during the EDHOC execution with P. This can rely on EDHOC message_2 or message_3, whose respective ID_CRED_R and ID_CRED_I field can specify CRED by value, or instead a URI or other external reference where CRED can be retrieved from (see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-3.5.3" class="relref">Section 3.5.3</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>).<a href="#section-3-3" class="pilcrow">¶</a></p>
<p id="section-3-4">Also during the EDHOC execution, an External Authorization Data (EAD) field might include an EAD item that specifies CRED by value or reference. This is the case, e.g., for the EAD items defined by the EDHOC and OSCORE profile of the ACE framework <span>[<a href="#I-D.ietf-ace-edhoc-oscore-profile" class="cite xref">I-D.ietf-ace-edhoc-oscore-profile</a>]</span>. In particular, they can be used for transporting (a reference to) an access token, which in turn specifies by value or by reference the public authentication credential associated with the EDHOC peer acting as ACE client.<a href="#section-3-4" class="pilcrow">¶</a></p>
<p id="section-3-5">When obtaining a new credential CRED, the peer P has to validate it before storing it. The validation steps to perform depend on the specific type of CRED (e.g., a public key certificate <span>[<a href="#RFC5280" class="cite xref">RFC5280</a>]</span><span>[<a href="#I-D.ietf-cose-cbor-encoded-cert" class="cite xref">I-D.ietf-cose-cbor-encoded-cert</a>]</span>) and can rely on (the authentication credential associated with) a trusted third party acting as a trust anchor.<a href="#section-3-5" class="pilcrow">¶</a></p>
<p id="section-3-6">Upon retrieving a new CRED through the processing of a received EDHOC message and following the successful validation of CRED, the peer P stores CRED only if it assesses CRED to also be (provisionally) trusted, while it must not store CRED otherwise.<a href="#section-3-6" class="pilcrow">¶</a></p>
<p id="section-3-7">An exception applies for the two unauthenticated operations described in <span><a href="https://rfc-editor.org/rfc/rfc9528#appendix-D.5" class="relref">Appendix D.5</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>, where a trust relationship with an unknown or not-yet-trusted endpoint is established later. In such a case, CRED is verified out-of-band at a later stage, or an EDHOC session key is bound to an identity out-of-band at a later stage.<a href="#section-3-7" class="pilcrow">¶</a></p>
<p id="section-3-8">When processing a received EDHOC message M that specifies an authentication credential CRED, the peer P can enforce one of the trust policies LEARNING and NO-LEARNING specified in <a href="#sec-policy-learning" class="auto internal xref">Section 3.1</a> and <a href="#sec-policy-no-learning" class="auto internal xref">Section 3.2</a>, in order to determine whether to trust CRED.<a href="#section-3-8" class="pilcrow">¶</a></p>
<p id="section-3-9">Irrespective of the adopted trust policy, P actually uses CRED only if it is determined to be fine to use in the context of the ongoing EDHOC session, also depending on the specific identity of the other peer (see Sections <a href="https://rfc-editor.org/rfc/rfc9528#section-3.5" class="relref">3.5</a> and <a href="https://rfc-editor.org/rfc/rfc9528#appendix-D.2" class="relref">D.2</a> of <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>). If this is not the case, P aborts the EDHOC session with the other peer.<a href="#section-3-9" class="pilcrow">¶</a></p>
<p id="section-3-10">If P stores CRED, then P will consider CRED as valid and trusted until:<a href="#section-3-10" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-11.1">
          <p id="section-3-11.1.1">CRED possibly becomes invalid, e.g., because it expires or because P gains knowledge that it has been revoked; or<a href="#section-3-11.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-11.2">
          <p id="section-3-11.2.1">CRED becomes non-trusted, e.g., because P originally assessed CRED to be provisionally trusted, and later on failed to obtain an expected final confirmation of trust.<a href="#section-3-11.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-3-12">P must delete CRED from its local storage if CRED becomes invalid or non-trusted.<a href="#section-3-12" class="pilcrow">¶</a></p>
<p id="section-3-13">When storing CRED, the peer P should generate the authentication credential identifier(s) corresponding to CRED and store them as associated with CRED. For example, if CRED is a public key certificate, an identifier of CRED can be the hash of the certificate. In general, P should generate and associate with CRED one corresponding identifier for each type of authentication credential identifier that P supports and that is compatible with CRED.<a href="#section-3-13" class="pilcrow">¶</a></p>
<p id="section-3-14">In future executions of EDHOC with the other peer associated with CRED, this allows such other peer to specify CRED by reference, e.g., by indicating its credential identifier as ID_CRED_R/ID_CRED_I in the EDHOC message_2 or message_3 addressed to the peer P. In turn, this allows P to retrieve CRED from its local storage.<a href="#section-3-14" class="pilcrow">¶</a></p>
<div id="sec-policy-learning">
<section id="section-3.1">
        <h3 id="name-trust-policy-learning">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-trust-policy-learning" class="section-name selfRef">Trust Policy LEARNING</a>
        </h3>
<p id="section-3.1-1">When enforcing the LEARNING policy, the peer P trusts CRED even if P is not already storing CRED at message reception time.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">That is, upon receiving M, the peer P performs the following steps.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.1-3">
<li id="section-3.1-3.1">
            <p id="section-3.1-3.1.1">P retrieves CRED, as specified by reference or by value in the ID_CRED_I/ID_CRED_R field of M or in the value of an EAD item of M.<a href="#section-3.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.1-3.2">
            <p id="section-3.1-3.2.1">P checks whether CRED is already being stored and if it is still valid and trusted. In such a case, P trusts CRED and can continue the EDHOC execution. Otherwise, P moves to Step 3.<a href="#section-3.1-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.1-3.3">
            <p id="section-3.1-3.3.1">P attempts to validate CRED. If the validation process is not successful, P aborts the EDHOC session with the other peer. Otherwise, P trusts and stores CRED, and can continue the EDHOC execution.<a href="#section-3.1-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
</section>
</div>
<div id="sec-policy-no-learning">
<section id="section-3.2">
        <h3 id="name-trust-policy-no-learning">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-trust-policy-no-learning" class="section-name selfRef">Trust Policy NO-LEARNING</a>
        </h3>
<p id="section-3.2-1">When enforcing the NO-LEARNING policy, the peer P trusts CRED only if P is already storing CRED at message reception time, unless in cases where situation-specific exceptions apply and are deliberately enforced (see below).<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">That is, upon receiving M, the peer P continues the execution of EDHOC only if both the following conditions hold:<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-3.1">
            <p id="section-3.2-3.1.1">P currently stores CRED, as specified by reference or by value in the ID_CRED_I/ID_CRED_R field of M or in the value of an EAD item of M; and<a href="#section-3.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-3.2">
            <p id="section-3.2-3.2.1">CRED is still valid (i.e., P believes CRED to not be expired or revoked) and trusted.<a href="#section-3.2-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.2-4">Exceptions may apply and be actually enforced in cases where, during an EDHOC execution, P obtains additional information that allows it to trust and successfully validate CRED, even though CRED is not already stored upon receiving M.<a href="#section-3.2-4" class="pilcrow">¶</a></p>
<p id="section-3.2-5">Such exceptions typically rely on a trusted party that vouches for CRED, e.g., in the cases discussed in <a href="#sec-trust-models-specific" class="auto internal xref">Section 3.3</a>. From the point of view of the peer P, the trusted party might have been involved in the background, so that the vouching information about CRED is conveyed within an EDHOC message received during the EDHOC session (e.g., transported by an EAD item). Alternatively, P might directly interact with the trusted party for retrieving the vouching information about CRED, e.g., after having received M and before continuing the EDHOC execution.<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<p id="section-3.2-6">If the peer P admits such an exception and actually enforces it on an authentication credential CRED, then P effectively handles CRED according to the trust policy "LEARNING" specified in <a href="#sec-policy-learning" class="auto internal xref">Section 3.1</a>. When doing so, P still attempts to validate CRED, and it aborts the EDHOC session if the validation process is not successful.<a href="#section-3.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-trust-models-specific">
<section id="section-3.3">
        <h3 id="name-enforcement-of-trust-polici">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-enforcement-of-trust-polici" class="section-name selfRef">Enforcement of Trust Policies in Specific Scenarios</a>
        </h3>
<p id="section-3.3-1">The following subsections discuss how an EDHOC peer enforces the trust policies LEARNING and NO-LEARNING in specific scenarios.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<div id="sec-trust-models-ace-prof">
<section id="section-3.3.1">
          <h4 id="name-in-the-edhoc-and-oscore-pro">
<a href="#section-3.3.1" class="section-number selfRef">3.3.1. </a><a href="#name-in-the-edhoc-and-oscore-pro" class="section-name selfRef">In the EDHOC and OSCORE Profile of ACE</a>
          </h4>
<p id="section-3.3.1-1">As discussed in <a href="#sec-keys-token-invalid" class="auto internal xref">Section 2.3</a>, two EDHOC peers can be using the ACE framework <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span> and specifically the EDHOC and OSCORE profile of ACE defined in <span>[<a href="#I-D.ietf-ace-edhoc-oscore-profile" class="cite xref">I-D.ietf-ace-edhoc-oscore-profile</a>]</span>.<a href="#section-3.3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.3.1-2">In this case, one of the two EDHOC peers, namely PEER_RS, acts as ACE resource server (RS). Instead, the other EDHOC peer, namely PEER_C, acts as ACE client and obtains from an ACE authorization server (AS) an access token for accessing protected resources at PEER_RS. The AS and PEER_RS are in a trust relationship.<a href="#section-3.3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.3.1-3">Together with other information, the access token specifies (by value or by reference) the public authentication credential AUTH_CRED_C associated with PEER_C that PEER_C is going to use when running EDHOC with PEER_RS. Note that AUTH_CRED_C will be used as either CRED_I or CRED_R in EDHOC, depending on whether the two peers use the EDHOC forward message flow (i.e., PEER_C is the EDHOC Initiator) or the EDHOC reverse message flow (i.e., PEER_C is the EDHOC Responder), respectively (see <span><a href="https://rfc-editor.org/rfc/rfc9528#appendix-A.2" class="relref">Appendix A.2</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>).<a href="#section-3.3.1-3" class="pilcrow">¶</a></p>
<p id="section-3.3.1-4">When the AS issues the first access token that specifies AUTH_CRED_C and is intended to be uploaded to PEER_RS, it is expected that the access token specifies AUTH_CRED_C by value and that PEER_RS is not currently storing AUTH_CRED_C, but instead will obtain it and learn it upon receiving the access token.<a href="#section-3.3.1-4" class="pilcrow">¶</a></p>
<p id="section-3.3.1-5">Although the AS can upload the access token to PEER_RS on behalf of PEER_C as per the alternative SDC workflow defined in <span>[<a href="#I-D.ietf-ace-workflow-and-params" class="cite xref">I-D.ietf-ace-workflow-and-params</a>]</span>, the access token is typically uploaded to PEER_RS by PEER_C through a dedicated EAD item, when running EDHOC with PEER_RS. Consequently, PEER_RS has to learn AUTH_CRED_C as a new authentication credential during an EDHOC session with PEER_C.<a href="#section-3.3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.3.1-6">At least for its EDHOC resource used for exchanging the EDHOC messages of the EDHOC session in question, this requires PEER_RS to:<a href="#section-3.3.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.1-7.1">
              <p id="section-3.3.1-7.1.1">Enforce the trust policy "LEARNING"; or<a href="#section-3.3.1-7.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.3.1-7.2">
              <p id="section-3.3.1-7.2.1">If enforcing the trust policy "NO-LEARNING", additionally enforce an overriding exception when an incoming EDHOC message includes an EAD item conveying (a reference to) a valid access token issued by a trusted AS.<a href="#section-3.3.1-7.2.1" class="pilcrow">¶</a></p>
<p id="section-3.3.1-7.2.2">
That is, through a successful verification of the access token, PEER_RS is able to trust AUTH_CRED_C (if found valid), even though it did not already store AUTH_CRED_C upon receiving the EDHOC message with the EAD item.<a href="#section-3.3.1-7.2.2" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="sec-trust-models-ela">
<section id="section-3.3.2">
          <h4 id="name-in-the-lightweight-authoriz">
<a href="#section-3.3.2" class="section-number selfRef">3.3.2. </a><a href="#name-in-the-lightweight-authoriz" class="section-name selfRef">In the Lightweight Authorization using EDHOC (ELA) Procedure</a>
          </h4>
<p id="section-3.3.2-1">Editor's note: the text in this section reflects an upcoming update in draft-ietf-lake-authz, which is expected to appear in version -07 of that document.<a href="#section-3.3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.3.2-2">When the execution of EDHOC embeds the ELA procedure defined in <span>[<a href="#I-D.ietf-lake-authz" class="cite xref">I-D.ietf-lake-authz</a>]</span>, the EDHOC peer U receives an EDHOC message_2 (message_3) where ID_CRED_R (ID_CRED_I) specifies by value the authentication credential CRED associated with the other peer V.<a href="#section-3.3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.3.2-3">Furthermore, an EDHOC message sent to U includes an EAD item, which specifies a voucher issued by a trusted enrollment server W. The voucher is an assertion to U that W has authorized V and has endorsed CRED.<a href="#section-3.3.2-3" class="pilcrow">¶</a></p>
<p id="section-3.3.2-4">The specific EDHOC message that includes the EAD item conveying the voucher depends on whether U and V use the EDHOC forward message flow (i.e., U is the EDHOC Initiator) or the EDHOC reverse message flow (i.e., U is the EDHOC Responder). In particular:<a href="#section-3.3.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.2-5.1">
              <p id="section-3.3.2-5.1.1">When using the EDHOC forward message flow, the EAD item is included in EDHOC message_4, thereby endorsing CRED that was specified by ID_CRED_R in the previous EDHOC message_2.<a href="#section-3.3.2-5.1.1" class="pilcrow">¶</a></p>
<p id="section-3.3.2-5.1.2">
Since it is indeed expected that U does not already store CRED upon receiving EDHOC message_2, U can at best provisionally trust CRED (if found valid) when retrieving it from EDHOC message_2.<a href="#section-3.3.2-5.1.2" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.3.2-5.2">
              <p id="section-3.3.2-5.2.1">When using the EDHOC reverse message flow, the EAD item is included in EDHOC message_3, thereby endorsing CRED that is specified by ID_CRED_I in the same EDHOC message.<a href="#section-3.3.2-5.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-3.3.2-6">In either case, through a successful verification of the voucher, U is able to ultimately trust CRED (if found valid), even though U did not already store CRED upon receiving the EDHOC message specifying CRED.<a href="#section-3.3.2-6" class="pilcrow">¶</a></p>
<p id="section-3.3.2-7">Therefore, if U enforces the trust policy "NO-LEARNING", it can additionally enforce an overriding exception as below:<a href="#section-3.3.2-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.2-8.1">
              <p id="section-3.3.2-8.1.1">When using the EDHOC forward message flow, the exception is enforced when processing an EDHOC message_2, and it is raised by the intention of using the ELA procedure. That is, U intends to proceed with sending a consistent EDHOC message_3 that indicates the wish to obtain a voucher issued by W.<a href="#section-3.3.2-8.1.1" class="pilcrow">¶</a></p>
<p id="section-3.3.2-8.1.2">
At that point in time, the authentication credential CRED is only provisionally trusted (if found valid), with the expectation to receive an EDHOC message_4 in the same EDHOC session, conveying a valid voucher issued by W and thus confirming that CRED can be ultimately trusted.<a href="#section-3.3.2-8.1.2" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.3.2-8.2">
              <p id="section-3.3.2-8.2.1">When using the EDHOC reverse message flow, the exception is enforced when processing an EDHOC message_3, and it is raised by the EDHOC message_3 including an EAD item that conveys a valid voucher issued by W, thus confirming that CRED can be ultimately trusted.<a href="#section-3.3.2-8.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sec-message-side-processing">
<section id="section-4">
      <h2 id="name-side-processing-of-incoming">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-side-processing-of-incoming" class="section-name selfRef">Side Processing of Incoming EDHOC Messages</a>
      </h2>
<p id="section-4-1">This section describes an approach that EDHOC peers can use upon receiving EDHOC messages, in order to fetch/validate authentication credentials and to process External Authorization Data (EAD) items.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">As per <span><a href="https://rfc-editor.org/rfc/rfc9528#section-9.1" class="relref">Section 9.1</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>, the EDHOC protocol provides a transport mechanism for conveying EAD items, but specifications defining those items have to set the ground for "agreeing on the surrounding context and the meaning of the information passed to and from the application".<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">The approach described in this section aims to help implementers navigate the surrounding context mentioned above, irrespective of the specific EAD items conveyed in the EDHOC messages. In particular, the described approach takes into account the following points:<a href="#section-4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-4.1">
          <p id="section-4-4.1.1">The fetching and validation of the authentication credential associated with the other peer relies on ID_CRED_I in EDHOC message_2, or on ID_CRED_R in EDHOC message_3, or on the value of an EAD item. When this occurs upon receiving EDHOC message_2 or message_3, the decryption of the EDHOC message has to be completed first.<a href="#section-4-4.1.1" class="pilcrow">¶</a></p>
<p id="section-4-4.1.2">
Validating the authentication credential or assessing whether it is trusted might depend on using the value of an EAD item, which in turn has to be validated first.<a href="#section-4-4.1.2" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-4.2">
          <p id="section-4-4.2.1">It is possible that some EAD items can be processed only after having successfully verified the EDHOC message, i.e., after a successful verification of the Signature_or_MAC field in EDHOC message_2 or message_3.<a href="#section-4-4.2.1" class="pilcrow">¶</a></p>
<p id="section-4-4.2.2">
For instance, an EAD item within the EAD_3 field of EDHOC message_3 might contain a Certificate Signing Request (CSR) <span>[<a href="#RFC2986" class="cite xref">RFC2986</a>]</span>. Hence, such an EAD item can be processed only once the recipient peer has attained proof that the other peer possesses its own private key.<a href="#section-4-4.2.2" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-4-5">In order to conveniently handle such processing, the application can prepare in advance a "side-processor object" (SPO), which takes care of the operations above during the EDHOC execution.<a href="#section-4-5" class="pilcrow">¶</a></p>
<p id="section-4-6">In particular, the application provides EDHOC with the SPO before starting an EDHOC execution, during which EDHOC will temporarily transfer control to the SPO at the right point in time, in order to perform the required side-processing of an incoming EDHOC message.<a href="#section-4-6" class="pilcrow">¶</a></p>
<p id="section-4-7">Furthermore, the application has to instruct the SPO about:<a href="#section-4-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-8.1">
          <p id="section-4-8.1.1">How to prepare any EAD item such that: it has to be included in an outgoing EDHOC message; and it is independent of the processing of other EAD items included in incoming EDHOC messages. This includes, for instance, the preparation of padding EAD items (see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-3.8.1" class="relref">Section 3.8.1</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>).<a href="#section-4-8.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-8.2">
          <p id="section-4-8.2.1">The list of EAD items that are expected to be present in specific, incoming EDHOC messages during the EDHOC session. This takes into account, for instance, external security applications that will be integrated in the EDHOC session (e.g., see <span>[<a href="#I-D.ietf-lake-authz" class="cite xref">I-D.ietf-lake-authz</a>]</span>).<a href="#section-4-8.2.1" class="pilcrow">¶</a></p>
<p id="section-4-8.2.2">
Throughout the EDHOC session, the SPO keeps such a list of expected EAD items up-to-date. This takes into account, for instance, external security applications that have been run integrated in the EDHOC session, the current status of the session, as well as the EDHOC messages that have been exchanged during the session and the outcome of their processing.<a href="#section-4-8.2.2" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-4-9">At the right point in time during the processing of an incoming EDHOC message M at the peer P, EDHOC invokes the SPO and provides it with the following input:<a href="#section-4-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-10.1">
          <p id="section-4-10.1.1">When M is EDHOC message_2 or message_3, an indication of whether this invocation is happening before or after the message verification (i.e., before or after having verified the Signature_or_MAC field).<a href="#section-4-10.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-10.2">
          <p id="section-4-10.2.1">The full set of information related to the current EDHOC session. This especially includes the selected cipher suite and the ephemeral Diffie-Hellman public keys G_X and G_Y that the two peers have exchanged in the EDHOC session.<a href="#section-4-10.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-10.3">
          <p id="section-4-10.3.1">The authentication credentials that the peer P stores as associated with other peers.<a href="#section-4-10.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-10.4">
          <p id="section-4-10.4.1">All the decrypted information elements retrieved from M.<a href="#section-4-10.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-10.5">
          <p id="section-4-10.5.1">The EAD items included in M.<a href="#section-4-10.5.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-10.5.2.1">
              <p id="section-4-10.5.2.1.1">Note that EDHOC might do some preliminary work on M before invoking the SPO, in order to provide the SPO only with actually relevant EAD items. This requires the application to additionally provide EDHOC with the ead_labels of the EAD items that the peer P recognizes (see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-3.8" class="relref">Section 3.8</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>).<a href="#section-4-10.5.2.1.1" class="pilcrow">¶</a></p>
<p id="section-4-10.5.2.1.2">
With such information available, EDHOC can early abort the current session in case M includes any EAD item which is both critical and not recognized by the peer P.<a href="#section-4-10.5.2.1.2" class="pilcrow">¶</a></p>
<p id="section-4-10.5.2.1.3">
If no such EAD items are found, EDHOC can remove any padding EAD item (see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-3.8.1" class="relref">Section 3.8.1</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>), as well as any EAD item which is neither critical nor recognized (since the SPO is going to ignore it anyway). This results in EDHOC providing the SPO only with EAD items that will be recognized and that require actual processing.<a href="#section-4-10.5.2.1.3" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-10.5.2.2">
              <p id="section-4-10.5.2.2.1">Note that, after having processed the EAD items, the SPO might actually need to store them throughout the whole EDHOC execution, e.g., in order to refer to them also when processing later EDHOC messages in the current EDHOC session.<a href="#section-4-10.5.2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
      </ul>
<p id="section-4-11">The SPO performs the following tasks on an incoming EDHOC message M:<a href="#section-4-11" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-12.1">
          <p id="section-4-12.1.1">The SPO checks whether M does not include an EAD item whose presence was expected, based on the related list maintained throughout the EDHOC session. If such an EAD item is absent, the SPO can come to an early determination about whether and how to proceed with the processing of M.<a href="#section-4-12.1.1" class="pilcrow">¶</a></p>
<p id="section-4-12.1.2">
In particular, if an EAD item is absent although its presence was strictly required, then the SPO can early abort the EDHOC session, thereby avoiding potentially costly operations (e.g., the retrieval and validation of the authentication credential associated with the other peer).<a href="#section-4-12.1.2" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-12.2">
          <p id="section-4-12.2.1">The SPO fetches and/or validates the authentication credential CRED associated with the other peer, based on a dedicated EAD item of M or on the ID_CRED field of M (for EDHOC message_2 or message_3).<a href="#section-4-12.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-12.3">
          <p id="section-4-12.3.1">The SPO processes the EAD items conveyed in the EAD field of M.<a href="#section-4-12.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-12.4">
          <p id="section-4-12.4.1">The SPO stores the results of the performed operations and makes such results available to the application.<a href="#section-4-12.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-12.5">
          <p id="section-4-12.5.1">When the SPO has completed its side processing and transfers control back to EDHOC, the SPO provides EDHOC with the produced EAD items to include in the EAD field of the next outgoing EDHOC message. The production of such EAD items can be triggered, e.g., by:<a href="#section-4-12.5.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-12.5.2.1">
              <p id="section-4-12.5.2.1.1">The consumption of EAD items included in M.<a href="#section-4-12.5.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-12.5.2.2">
              <p id="section-4-12.5.2.2.1">The execution of instructions that the SPO has received from the application, concerning EAD items to produce irrespective of other EAD items included in M.<a href="#section-4-12.5.2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
      </ul>
<p id="section-4-13">In the following, <a href="#sec-message-side-processing-m1" class="auto internal xref">Section 4.1</a> to <a href="#sec-message-side-processing-m2-m3" class="auto internal xref">Section 4.3</a> describe more in detail the actions performed by the SPO on the different incoming EDHOC messages. Then, <a href="#sec-consistency-checks-auth-creds" class="auto internal xref">Section 4.4</a> describes further special handling of incoming EDHOC messages, as to consistency checks concerning authentication credentials in particular situations.<a href="#section-4-13" class="pilcrow">¶</a></p>
<p id="section-4-14">After completing the EDHOC execution, control is transferred back to the application. In particular, the application is provided with the overall outcome of the EDHOC execution (i.e., successful completion or failure), together with possible specific results produced by the SPO throughout the EDHOC execution (e.g., due to the processing of EAD items).<a href="#section-4-14" class="pilcrow">¶</a></p>
<p id="section-4-15">After that, the application might need to perform follow-up actions, depending on the outcome of the EDHOC execution. For example, the SPO might have preliminarily filled application-level data structures, as a result of processing EAD items. In case of successful EDHOC execution, the application might need to finalize such data structures. Instead, in case of unsuccessful EDHOC execution, the application might need to clean-up or amend such data structures, or even roll back what the SPO did, unless the SPO already performed such actions before control was transferred back to the application.<a href="#section-4-15" class="pilcrow">¶</a></p>
<div id="sec-message-side-processing-m1">
<section id="section-4.1">
        <h3 id="name-edhoc-message_1">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-edhoc-message_1" class="section-name selfRef">EDHOC message_1</a>
        </h3>
<p id="section-4.1-1">During the processing of an incoming EDHOC message_1, EDHOC invokes the SPO only once, after the Responder peer has successfully decoded the message and accepted the selected cipher suite.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">If the EAD_1 field is present, the SPO processes the EAD items included therein.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">Once all such EAD items have been processed, the SPO transfers control back to EDHOC. When doing so, the SPO also provides EDHOC with any produced EAD items to include in the EAD field of the next outgoing EDHOC message.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">Then, EDHOC resumes its execution and advances its protocol state.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1-5">Future extensions of EDHOC or external security applications integrated into EDHOC might require a processing of EDHOC message_1 that is more advanced than the currently expected one. In particular, an EAD item conveyed in EDHOC message_1 might specify the authentication credential CRED associated with the Initiator (by value or by reference), as wrapped in a cryptographically protected "envelope". In such a case, the processing of an incoming EDHOC message_1 shares similarities with that of an incoming EDHOC message_2 or message_3 (see <a href="#sec-message-side-processing-m2-m3" class="auto internal xref">Section 4.3</a>), as it is further elaborated in <a href="#sec-message-side-processing-m1-advanced" class="auto internal xref">Appendix A</a>.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-message-side-processing-m4">
<section id="section-4.2">
        <h3 id="name-edhoc-message_4">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-edhoc-message_4" class="section-name selfRef">EDHOC message_4</a>
        </h3>
<p id="section-4.2-1">During the processing of an incoming EDHOC message_4, EDHOC invokes the SPO only once, after the Initiator peer has successfully decrypted the message.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">If the EAD_4 field is present, the SPO processes the EAD items included therein.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">Once all such EAD items have been processed, the SPO transfers control back to EDHOC, which resumes its execution and advances its protocol state.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-message-side-processing-m2-m3">
<section id="section-4.3">
        <h3 id="name-edhoc-message_2-and-message">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-edhoc-message_2-and-message" class="section-name selfRef">EDHOC message_2 and message_3</a>
        </h3>
<p id="section-4.3-1">The following refers to "message_X" as an incoming EDHOC message_2 or message_3, and to "message verification" as the verification of Signature_or_MAC_X in message_X.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">During the processing of a message_X, EDHOC invokes the SPO two times:<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-3.1">
            <p id="section-4.3-3.1.1">Right after message_X has been decrypted and before its verification starts. Following this invocation, the SPO performs the actions described in <a href="#sec-pre-verif" class="auto internal xref">Section 4.3.1</a>.<a href="#section-4.3-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-3.2">
            <p id="section-4.3-3.2.1">Right after message_X has been successfully verified. Following this invocation, the SPO performs the actions described in <a href="#sec-post-verif" class="auto internal xref">Section 4.3.2</a>.<a href="#section-4.3-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.3-4">The flowcharts in <a href="#sec-m2-m3-flowcharts" class="auto internal xref">Section 4.3.3</a> show the high-level interaction between the core EDHOC processing and the SPO, as well as the different steps taken for processing an incoming message_X.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<div id="sec-pre-verif">
<section id="section-4.3.1">
          <h4 id="name-pre-verification-side-proce">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-pre-verification-side-proce" class="section-name selfRef">Pre-Verification Side Processing</a>
          </h4>
<p id="section-4.3.1-1">The pre-verification side processing occurs in two sequential phases, namely PHASE_1 (see <a href="#sec-pre-verif-phase-1" class="auto internal xref">Section 4.3.1.1</a>) and PHASE_2 (see <a href="#sec-pre-verif-phase-2" class="auto internal xref">Section 4.3.1.2</a>).<a href="#section-4.3.1-1" class="pilcrow">¶</a></p>
<div id="sec-pre-verif-phase-1">
<section id="section-4.3.1.1">
            <h5 id="name-phase_1">
<a href="#section-4.3.1.1" class="section-number selfRef">4.3.1.1. </a><a href="#name-phase_1" class="section-name selfRef">PHASE_1</a>
            </h5>
<p id="section-4.3.1.1-1">During PHASE_1, the SPO at the recipient peer P determines CRED, i.e., the authentication credential associated with the other peer to be used in the ongoing EDHOC session. In particular, the SPO first checks whether expected EAD items are absent in message_X (see <a href="#sec-message-side-processing" class="auto internal xref">Section 4</a>), and then performs the following steps.<a href="#section-4.3.1.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.3.1.1-2">
<li id="section-4.3.1.1-2.1">
                <p id="section-4.3.1.1-2.1.1">The SPO determines CRED based on ID_CRED_X or on an EAD item included in message_X.<a href="#section-4.3.1.1-2.1.1" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-2.1.2">
Those may specify CRED by value or by reference, including a URI or other external reference where CRED can be retrieved from.<a href="#section-4.3.1.1-2.1.2" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-2.1.3">
If CRED is already installed, the SPO moves to Step 2. Otherwise, the SPO moves to Step 3.<a href="#section-4.3.1.1-2.1.3" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.3.1.1-2.2">
                <p id="section-4.3.1.1-2.2.1">The SPO determines if the stored CRED is currently trusted and valid, e.g., by verifying that CRED has not expired and has not been revoked.<a href="#section-4.3.1.1-2.2.1" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-2.2.2">
Performing such a validation might require the SPO to first process an EAD item included in message_X. For example, it can be an EAD item in EDHOC message_2 that confirms or revokes the validity of CRED_R specified by ID_CRED_R, as the result of an OCSP process <span>[<a href="#RFC6960" class="cite xref">RFC6960</a>]</span>.<a href="#section-4.3.1.1-2.2.2" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-2.2.3">
In case CRED is determined to be valid, the SPO moves to Step 9. Otherwise, the SPO moves to Step 11.<a href="#section-4.3.1.1-2.2.3" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.3.1.1-2.3">
                <p id="section-4.3.1.1-2.3.1">The SPO attempts to retrieve CRED via ID_CRED_X or an EAD item considered at Step 1. Then, the SPO moves to Step 4.<a href="#section-4.3.1.1-2.3.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.3.1.1-2.4">
                <p id="section-4.3.1.1-2.4.1">If the retrieval of CRED has succeeded, the SPO moves to Step 5. Otherwise, the SPO moves to Step 11.<a href="#section-4.3.1.1-2.4.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.3.1.1-2.5">
                <p id="section-4.3.1.1-2.5.1">If the enforced trust policy for new authentication credentials is "NO-LEARNING" and P does not admit any exceptions that are acceptable to enforce for message_X (see <a href="#sec-policy-no-learning" class="auto internal xref">Section 3.2</a>), the SPO moves to Step 11. Otherwise, the SPO moves to Step 6.<a href="#section-4.3.1.1-2.5.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.3.1.1-2.6">
                <p id="section-4.3.1.1-2.6.1">If this step has been reached, the peer P is not already storing the retrieved CRED and, at the same time, it enforces either the trust policy "LEARNING" or the trust policy "NO-LEARNING" while also enforcing an exception acceptable for message_X (see <a href="#sec-policy-no-learning" class="auto internal xref">Section 3.2</a>).<a href="#section-4.3.1.1-2.6.1" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-2.6.2">
Consistently, the SPO determines if CRED is currently valid, e.g., by verifying that CRED has not expired and has not been revoked.<a href="#section-4.3.1.1-2.6.2" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-2.6.3">
Validating CRED might require the SPO to first process an EAD item included in message_X. For example, it can be an OCSP response <span>[<a href="#RFC6960" class="cite xref">RFC6960</a>]</span> for validating CRED_R as a public key certificate transported by value or reference in ID_CRED_R.<a href="#section-4.3.1.1-2.6.3" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-2.6.4">
After successfully validating CRED, the peer P can typically consider CRED as ultimately trusted as well. However, there can be cases where P requires to obtain additional information before doing so.<a href="#section-4.3.1.1-2.6.4" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-2.6.5">
If such additional information can be retrieved from message_X (e.g., from an EAD item included therein), then P uses it to assess if CRED is trusted. Otherwise, if such additional information is expected later on during the EDHOC session, it can be acceptable for P to consider CRED as provisionally trusted.<a href="#section-4.3.1.1-2.6.5" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-2.6.6"><a href="#sec-trust-models-ela" class="auto internal xref">Section 3.3.2</a> discusses the ELA procedure defined in <span>[<a href="#I-D.ietf-lake-authz" class="cite xref">I-D.ietf-lake-authz</a>]</span>, as a case in point where additional information required by the peer P to trust CRED could not be included in the same message that specifies CRED.<a href="#section-4.3.1.1-2.6.6" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-2.6.7">
Editor's note: the previous paragraph reflects an upcoming update in draft-ietf-lake-authz, which is expected to appear in version -07 of that document.<a href="#section-4.3.1.1-2.6.7" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-2.6.8">
After completing the validation and trust assessment of CRED, the SPO moves to Step 7.<a href="#section-4.3.1.1-2.6.8" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.3.1.1-2.7">
                <p id="section-4.3.1.1-2.7.1">If CRED has been determined valid and (provisionally) trusted, the SPO moves to Step 8. Otherwise, the SPO moves to Step 11.<a href="#section-4.3.1.1-2.7.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.3.1.1-2.8">
                <p id="section-4.3.1.1-2.8.1">The SPO stores CRED as a valid and (provisionally) trusted authentication credential associated with the other peer, together with corresponding authentication credential identifiers (see <a href="#sec-trust-models" class="auto internal xref">Section 3</a>). Then, the SPO moves to Step 9.<a href="#section-4.3.1.1-2.8.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.3.1.1-2.9">
                <p id="section-4.3.1.1-2.9.1">The SPO checks if CRED is fine to use in the context of the ongoing EDHOC session, also depending on the specific identity of the other peer (see Sections <a href="https://rfc-editor.org/rfc/rfc9528#section-3.5" class="relref">3.5</a> and <a href="https://rfc-editor.org/rfc/rfc9528#appendix-D.2" class="relref">D.2</a> of <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>).<a href="#section-4.3.1.1-2.9.1" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-2.9.2">
If this is the case, the SPO moves to Step 10. Otherwise, the SPO moves to Step 11.<a href="#section-4.3.1.1-2.9.2" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.3.1.1-2.10">
                <p id="section-4.3.1.1-2.10.1">P uses CRED as authentication credential associated with the other peer in the ongoing EDHOC session.<a href="#section-4.3.1.1-2.10.1" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-2.10.2">
Then, PHASE_1 ends and the pre-verification side processing moves to the next PHASE_2 (see <a href="#sec-pre-verif-phase-2" class="auto internal xref">Section 4.3.1.2</a>).<a href="#section-4.3.1.1-2.10.2" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.3.1.1-2.11">
                <p id="section-4.3.1.1-2.11.1">The SPO has not found a valid and (provisionally) trusted authentication credential associated with the other peer that can be used in the ongoing EDHOC session. Therefore, the EDHOC session with the other peer is aborted.<a href="#section-4.3.1.1-2.11.1" class="pilcrow">¶</a></p>
</li>
            </ol>
</section>
</div>
<div id="sec-pre-verif-phase-2">
<section id="section-4.3.1.2">
            <h5 id="name-phase_2">
<a href="#section-4.3.1.2" class="section-number selfRef">4.3.1.2. </a><a href="#name-phase_2" class="section-name selfRef">PHASE_2</a>
            </h5>
<p id="section-4.3.1.2-1">During PHASE_2, the SPO processes any EAD item included in message_X such that both the following conditions hold:<a href="#section-4.3.1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.1.2-2.1">
                <p id="section-4.3.1.2-2.1.1">The EAD item has <em>not</em> already been processed during PHASE_1.<a href="#section-4.3.1.2-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.3.1.2-2.2">
                <p id="section-4.3.1.2-2.2.1">The EAD item can be processed before performing the verification of message_X.<a href="#section-4.3.1.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-4.3.1.2-3">Once all such EAD items have been processed, the SPO transfers control back to EDHOC, which either aborts the ongoing EDHOC session or continues the processing of message_X with its corresponding message verification.<a href="#section-4.3.1.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-post-verif">
<section id="section-4.3.2">
          <h4 id="name-post-verification-side-proc">
<a href="#section-4.3.2" class="section-number selfRef">4.3.2. </a><a href="#name-post-verification-side-proc" class="section-name selfRef">Post-Verification Side Processing</a>
          </h4>
<p id="section-4.3.2-1">During the post-verification side processing, the SPO processes any EAD item included in message_X such that the processing of that EAD item had to wait for completing the successful message verification.<a href="#section-4.3.2-1" class="pilcrow">¶</a></p>
<p id="section-4.3.2-2">The late processing of such EAD items is typically due to the fact that a pre-requirement has to be fulfilled first.<a href="#section-4.3.2-2" class="pilcrow">¶</a></p>
<p id="section-4.3.2-3">For example, the recipient peer P has to have first verified that the other peer does possess the private key corresponding to the public key specified by CRED, i.e., the authentication credential associated with the other peer that was determined during the pre-verification side processing (see <a href="#sec-pre-verif" class="auto internal xref">Section 4.3.1</a>). This requirement is fulfilled after a successful verification of message_X.<a href="#section-4.3.2-3" class="pilcrow">¶</a></p>
<p id="section-4.3.2-4">Once all such EAD items have been processed, the SPO transfers control back to EDHOC. When doing so, the SPO also provides EDHOC with any produced EAD items to include in the EAD field of the next outgoing EDHOC message.<a href="#section-4.3.2-4" class="pilcrow">¶</a></p>
<p id="section-4.3.2-5">Then, EDHOC resumes its execution and advances its protocol state.<a href="#section-4.3.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-m2-m3-flowcharts">
<section id="section-4.3.3">
          <h4 id="name-flowcharts">
<a href="#section-4.3.3" class="section-number selfRef">4.3.3. </a><a href="#name-flowcharts" class="section-name selfRef">Flowcharts</a>
          </h4>
<p id="section-4.3.3-1">The flowchart in <a href="#fig-flowchart-spo-high-level" class="auto internal xref">Figure 4</a> shows the high-level interaction between the core EDHOC processing and the SPO, with particular reference to an incoming EDHOC message_2 or message_3.<a href="#section-4.3.3-1" class="pilcrow">¶</a></p>
<span id="name-high-level-interaction-betw"></span><div id="fig-flowchart-spo-high-level">
<figure id="figure-4">
            <div id="section-4.3.3-2.1">
              <div class="alignCenter art-svg artwork" id="section-4.3.3-2.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="848" width="576" viewBox="0 0 576 848" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                  <path d="M 8,128 L 8,384" fill="none" stroke="black"></path>
                  <path d="M 8,512 L 8,832" fill="none" stroke="black"></path>
                  <path d="M 24,176 L 24,224" fill="none" stroke="black"></path>
                  <path d="M 24,560 L 24,800" fill="none" stroke="black"></path>
                  <path d="M 56,96 L 56,168" fill="none" stroke="black"></path>
                  <path d="M 64,288 L 64,336" fill="none" stroke="black"></path>
                  <path d="M 120,176 L 120,224" fill="none" stroke="black"></path>
                  <path d="M 144,344 L 144,552" fill="none" stroke="black"></path>
                  <path d="M 160,176 L 160,224" fill="none" stroke="black"></path>
                  <path d="M 176,232 L 176,280" fill="none" stroke="black"></path>
                  <path d="M 184,288 L 184,336" fill="none" stroke="black"></path>
                  <path d="M 224,288 L 224,336" fill="none" stroke="black"></path>
                  <path d="M 240,344 L 240,552" fill="none" stroke="black"></path>
                  <path d="M 248,560 L 248,800" fill="none" stroke="black"></path>
                  <path d="M 296,176 L 296,224" fill="none" stroke="black"></path>
                  <path d="M 296,560 L 296,608" fill="none" stroke="black"></path>
                  <path d="M 336,344 L 336,552" fill="none" stroke="black"></path>
                  <path d="M 392,288 L 392,336" fill="none" stroke="black"></path>
                  <path d="M 400,176 L 400,224" fill="none" stroke="black"></path>
                  <path d="M 416,232 L 416,552" fill="none" stroke="black"></path>
                  <path d="M 488,608 L 488,640" fill="none" stroke="black"></path>
                  <path d="M 536,176 L 536,224" fill="none" stroke="black"></path>
                  <path d="M 536,560 L 536,608" fill="none" stroke="black"></path>
                  <path d="M 568,128 L 568,384" fill="none" stroke="black"></path>
                  <path d="M 568,512 L 568,832" fill="none" stroke="black"></path>
                  <path d="M 8,128 L 48,128" fill="none" stroke="black"></path>
                  <path d="M 64,128 L 568,128" fill="none" stroke="black"></path>
                  <path d="M 24,176 L 120,176" fill="none" stroke="black"></path>
                  <path d="M 160,176 L 296,176" fill="none" stroke="black"></path>
                  <path d="M 400,176 L 536,176" fill="none" stroke="black"></path>
                  <path d="M 128,192 L 152,192" fill="none" stroke="black"></path>
                  <path d="M 24,224 L 120,224" fill="none" stroke="black"></path>
                  <path d="M 160,224 L 296,224" fill="none" stroke="black"></path>
                  <path d="M 400,224 L 536,224" fill="none" stroke="black"></path>
                  <path d="M 64,288 L 184,288" fill="none" stroke="black"></path>
                  <path d="M 224,288 L 392,288" fill="none" stroke="black"></path>
                  <path d="M 64,336 L 184,336" fill="none" stroke="black"></path>
                  <path d="M 224,336 L 392,336" fill="none" stroke="black"></path>
                  <path d="M 8,384 L 136,384" fill="none" stroke="black"></path>
                  <path d="M 152,384 L 232,384" fill="none" stroke="black"></path>
                  <path d="M 248,384 L 328,384" fill="none" stroke="black"></path>
                  <path d="M 344,384 L 408,384" fill="none" stroke="black"></path>
                  <path d="M 424,384 L 568,384" fill="none" stroke="black"></path>
                  <path d="M 8,512 L 136,512" fill="none" stroke="black"></path>
                  <path d="M 152,512 L 232,512" fill="none" stroke="black"></path>
                  <path d="M 248,512 L 328,512" fill="none" stroke="black"></path>
                  <path d="M 344,512 L 408,512" fill="none" stroke="black"></path>
                  <path d="M 424,512 L 568,512" fill="none" stroke="black"></path>
                  <path d="M 24,560 L 248,560" fill="none" stroke="black"></path>
                  <path d="M 296,560 L 536,560" fill="none" stroke="black"></path>
                  <path d="M 296,608 L 480,608" fill="none" stroke="black"></path>
                  <path d="M 496,608 L 536,608" fill="none" stroke="black"></path>
                  <path d="M 256,640 L 312,640" fill="none" stroke="black"></path>
                  <path d="M 432,640 L 480,640" fill="none" stroke="black"></path>
                  <path d="M 24,800 L 248,800" fill="none" stroke="black"></path>
                  <path d="M 8,832 L 568,832" fill="none" stroke="black"></path>
                  <polygon class="arrowhead" points="424,232 412,226.4 412,237.6" fill="black" transform="rotate(270,416,232)"></polygon>
                  <polygon class="arrowhead" points="344,552 332,546.4 332,557.6" fill="black" transform="rotate(90,336,552)"></polygon>
                  <polygon class="arrowhead" points="248,344 236,338.4 236,349.6" fill="black" transform="rotate(270,240,344)"></polygon>
                  <polygon class="arrowhead" points="184,280 172,274.4 172,285.6" fill="black" transform="rotate(90,176,280)"></polygon>
                  <polygon class="arrowhead" points="160,192 148,186.4 148,197.6" fill="black" transform="rotate(0,152,192)"></polygon>
                  <polygon class="arrowhead" points="152,552 140,546.4 140,557.6" fill="black" transform="rotate(90,144,552)"></polygon>
                  <polygon class="arrowhead" points="64,168 52,162.4 52,173.6" fill="black" transform="rotate(90,56,168)"></polygon>
                  <circle cx="248" cy="640" r="6" class="opendot" fill="white" stroke="black"></circle>
                  <circle cx="488" cy="608" r="6" class="opendot" fill="white" stroke="black"></circle>
                  <circle cx="488" cy="640" r="6" class="opendot" fill="white" stroke="black"></circle>
                  <g class="text">
                    <text x="36" y="36">Incoming</text>
                    <text x="24" y="52">EDHOC</text>
                    <text x="88" y="52">message_X</text>
                    <text x="12" y="68">(X</text>
                    <text x="32" y="68">=</text>
                    <text x="48" y="68">2</text>
                    <text x="68" y="68">or</text>
                    <text x="92" y="68">3)</text>
                    <text x="404" y="148">Core</text>
                    <text x="448" y="148">EDHOC</text>
                    <text x="516" y="148">processing</text>
                    <text x="60" y="196">Decode</text>
                    <text x="204" y="196">Retrieve</text>
                    <text x="256" y="196">the</text>
                    <text x="440" y="196">Advance</text>
                    <text x="488" y="196">the</text>
                    <text x="72" y="212">message_X</text>
                    <text x="204" y="212">protocol</text>
                    <text x="264" y="212">state</text>
                    <text x="444" y="212">protocol</text>
                    <text x="504" y="212">state</text>
                    <text x="104" y="308">Decrypt</text>
                    <text x="260" y="308">Verify</text>
                    <text x="124" y="324">CIPHERTEXT_X</text>
                    <text x="308" y="324">Signature_or_MAC_X</text>
                    <text x="496" y="420">.................</text>
                    <text x="108" y="436">Divert</text>
                    <text x="208" y="436">Get</text>
                    <text x="300" y="436">Divert</text>
                    <text x="384" y="436">Get</text>
                    <text x="432" y="436">:</text>
                    <text x="456" y="436">EAD</text>
                    <text x="496" y="436">items</text>
                    <text x="560" y="436">:</text>
                    <text x="212" y="452">back</text>
                    <text x="388" y="452">back</text>
                    <text x="432" y="452">:</text>
                    <text x="456" y="452">for</text>
                    <text x="488" y="452">the</text>
                    <text x="524" y="452">next</text>
                    <text x="560" y="452">:</text>
                    <text x="432" y="468">:</text>
                    <text x="464" y="468">EDHOC</text>
                    <text x="520" y="468">message</text>
                    <text x="560" y="468">:</text>
                    <text x="496" y="484">:...............:</text>
                    <text x="44" y="580">a)</text>
                    <text x="80" y="580">Check</text>
                    <text x="136" y="580">whether</text>
                    <text x="204" y="580">expected</text>
                    <text x="348" y="580">Processing</text>
                    <text x="404" y="580">of</text>
                    <text x="72" y="596">EAD</text>
                    <text x="112" y="596">items</text>
                    <text x="152" y="596">are</text>
                    <text x="196" y="596">absent</text>
                    <text x="376" y="596">post-verification</text>
                    <text x="464" y="596">EAD</text>
                    <text x="504" y="596">items</text>
                    <text x="44" y="612">b)</text>
                    <text x="96" y="612">Retrieval</text>
                    <text x="152" y="612">and</text>
                    <text x="100" y="628">validation</text>
                    <text x="156" y="628">of</text>
                    <text x="200" y="628">CRED_X;</text>
                    <text x="44" y="644">c)</text>
                    <text x="80" y="644">Trust</text>
                    <text x="148" y="644">assessment</text>
                    <text x="348" y="644">Shared</text>
                    <text x="400" y="644">state</text>
                    <text x="68" y="660">of</text>
                    <text x="112" y="660">CRED_X;</text>
                    <text x="44" y="676">d)</text>
                    <text x="100" y="676">Processing</text>
                    <text x="156" y="676">of</text>
                    <text x="404" y="676">......................</text>
                    <text x="124" y="692">pre-verification</text>
                    <text x="320" y="692">:</text>
                    <text x="380" y="692">Instructions</text>
                    <text x="456" y="692">about</text>
                    <text x="488" y="692">:</text>
                    <text x="72" y="708">EAD</text>
                    <text x="112" y="708">items</text>
                    <text x="320" y="708">:</text>
                    <text x="344" y="708">EAD</text>
                    <text x="384" y="708">items</text>
                    <text x="420" y="708">to</text>
                    <text x="488" y="708">:</text>
                    <text x="320" y="724">:</text>
                    <text x="392" y="724">unconditionally</text>
                    <text x="488" y="724">:</text>
                    <text x="40" y="740">-</text>
                    <text x="64" y="740">(b)</text>
                    <text x="96" y="740">and</text>
                    <text x="128" y="740">(d)</text>
                    <text x="168" y="740">might</text>
                    <text x="212" y="740">have</text>
                    <text x="320" y="740">:</text>
                    <text x="360" y="740">produce</text>
                    <text x="408" y="740">for</text>
                    <text x="440" y="740">the</text>
                    <text x="488" y="740">:</text>
                    <text x="60" y="756">to</text>
                    <text x="96" y="756">occur</text>
                    <text x="132" y="756">in</text>
                    <text x="180" y="756">parallel</text>
                    <text x="320" y="756">:</text>
                    <text x="348" y="756">next</text>
                    <text x="392" y="756">EDHOC</text>
                    <text x="448" y="756">message</text>
                    <text x="488" y="756">:</text>
                    <text x="40" y="772">-</text>
                    <text x="64" y="772">(c)</text>
                    <text x="112" y="772">depends</text>
                    <text x="156" y="772">on</text>
                    <text x="184" y="772">the</text>
                    <text x="404" y="772">:....................:</text>
                    <text x="72" y="788">trust</text>
                    <text x="124" y="788">policy</text>
                    <text x="172" y="788">used</text>
                    <text x="396" y="820">Side-Processor</text>
                    <text x="484" y="820">Object</text>
                    <text x="536" y="820">(SPO)</text>
                  </g>
                </svg><a href="#section-4.3.3-2.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-high-level-interaction-betw" class="selfRef">High-Level Interaction Between the Core EDHOC Processing and the Side-Processor Object (SPO), for EDHOC message_2 and message_3.</a>
            </figcaption></figure>
</div>
<p id="section-4.3.3-3">The flowchart in <a href="#fig-flowchart-spo-low-level" class="auto internal xref">Figure 5</a> shows the different steps taken for processing an incoming EDHOC message_2 and message_3.<a href="#section-4.3.3-3" class="pilcrow">¶</a></p>
<span id="name-processing-steps-for-edhoc-"></span><div id="fig-flowchart-spo-low-level">
<figure id="figure-5">
            <div id="section-4.3.3-4.1">
              <div class="alignCenter art-svg artwork" id="section-4.3.3-4.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="2560" width="576" viewBox="0 0 576 2560" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                  <path d="M 8,512 L 8,1552" fill="none" stroke="black"></path>
                  <path d="M 8,1600 L 8,1728" fill="none" stroke="black"></path>
                  <path d="M 8,2080 L 8,2320" fill="none" stroke="black"></path>
                  <path d="M 16,144 L 16,176" fill="none" stroke="black"></path>
                  <path d="M 16,240 L 16,288" fill="none" stroke="black"></path>
                  <path d="M 16,352 L 16,384" fill="none" stroke="black"></path>
                  <path d="M 16,1904 L 16,1936" fill="none" stroke="black"></path>
                  <path d="M 16,2496 L 16,2544" fill="none" stroke="black"></path>
                  <path d="M 24,560 L 24,608" fill="none" stroke="black"></path>
                  <path d="M 24,672 L 24,752" fill="none" stroke="black"></path>
                  <path d="M 24,864 L 24,928" fill="none" stroke="black"></path>
                  <path d="M 24,1024 L 24,1104" fill="none" stroke="black"></path>
                  <path d="M 24,1392 L 24,1520" fill="none" stroke="black"></path>
                  <path d="M 24,1648 L 24,1696" fill="none" stroke="black"></path>
                  <path d="M 24,2128 L 24,2176" fill="none" stroke="black"></path>
                  <path d="M 24,2240 L 24,2288" fill="none" stroke="black"></path>
                  <path d="M 88,96 L 88,136" fill="none" stroke="black"></path>
                  <path d="M 88,184 L 88,232" fill="none" stroke="black"></path>
                  <path d="M 88,296 L 88,344" fill="none" stroke="black"></path>
                  <path d="M 88,392 L 88,416" fill="none" stroke="black"></path>
                  <path d="M 88,496 L 88,552" fill="none" stroke="black"></path>
                  <path d="M 88,616 L 88,664" fill="none" stroke="black"></path>
                  <path d="M 88,760 L 88,856" fill="none" stroke="black"></path>
                  <path d="M 88,936 L 88,1016" fill="none" stroke="black"></path>
                  <path d="M 88,1112 L 88,1384" fill="none" stroke="black"></path>
                  <path d="M 88,1528 L 88,1640" fill="none" stroke="black"></path>
                  <path d="M 88,1704 L 88,1776" fill="none" stroke="black"></path>
                  <path d="M 88,1856 L 88,1896" fill="none" stroke="black"></path>
                  <path d="M 88,1944 L 88,1984" fill="none" stroke="black"></path>
                  <path d="M 88,2064 L 88,2120" fill="none" stroke="black"></path>
                  <path d="M 88,2184 L 88,2232" fill="none" stroke="black"></path>
                  <path d="M 88,2296 L 88,2368" fill="none" stroke="black"></path>
                  <path d="M 88,2448 L 88,2488" fill="none" stroke="black"></path>
                  <path d="M 152,2496 L 152,2544" fill="none" stroke="black"></path>
                  <path d="M 168,864 L 168,928" fill="none" stroke="black"></path>
                  <path d="M 168,1904 L 168,1936" fill="none" stroke="black"></path>
                  <path d="M 176,144 L 176,176" fill="none" stroke="black"></path>
                  <path d="M 176,240 L 176,288" fill="none" stroke="black"></path>
                  <path d="M 176,352 L 176,384" fill="none" stroke="black"></path>
                  <path d="M 176,1392 L 176,1520" fill="none" stroke="black"></path>
                  <path d="M 192,1024 L 192,1104" fill="none" stroke="black"></path>
                  <path d="M 200,672 L 200,752" fill="none" stroke="black"></path>
                  <path d="M 224,144 L 224,384" fill="none" stroke="black"></path>
                  <path d="M 224,560 L 224,608" fill="none" stroke="black"></path>
                  <path d="M 248,672 L 248,752" fill="none" stroke="black"></path>
                  <path d="M 248,864 L 248,1056" fill="none" stroke="black"></path>
                  <path d="M 248,1088 L 248,1424" fill="none" stroke="black"></path>
                  <path d="M 296,800 L 296,856" fill="none" stroke="black"></path>
                  <path d="M 296,1280 L 296,1328" fill="none" stroke="black"></path>
                  <path d="M 296,1392 L 296,1520" fill="none" stroke="black"></path>
                  <path d="M 320,1064 L 320,1272" fill="none" stroke="black"></path>
                  <path d="M 320,1336 L 320,1384" fill="none" stroke="black"></path>
                  <path d="M 344,864 L 344,1056" fill="none" stroke="black"></path>
                  <path d="M 368,672 L 368,752" fill="none" stroke="black"></path>
                  <path d="M 384,2240 L 384,2288" fill="none" stroke="black"></path>
                  <path d="M 392,2128 L 392,2176" fill="none" stroke="black"></path>
                  <path d="M 408,864 L 408,976" fill="none" stroke="black"></path>
                  <path d="M 416,672 L 416,752" fill="none" stroke="black"></path>
                  <path d="M 416,1152 L 416,1216" fill="none" stroke="black"></path>
                  <path d="M 416,2080 L 416,2320" fill="none" stroke="black"></path>
                  <path d="M 432,760 L 432,800" fill="none" stroke="black"></path>
                  <path d="M 480,1648 L 480,1696" fill="none" stroke="black"></path>
                  <path d="M 512,760 L 512,856" fill="none" stroke="black"></path>
                  <path d="M 512,984 L 512,1144" fill="none" stroke="black"></path>
                  <path d="M 512,1224 L 512,1272" fill="none" stroke="black"></path>
                  <path d="M 528,672 L 528,752" fill="none" stroke="black"></path>
                  <path d="M 544,1152 L 544,1216" fill="none" stroke="black"></path>
                  <path d="M 552,864 L 552,976" fill="none" stroke="black"></path>
                  <path d="M 552,1280 L 552,1328" fill="none" stroke="black"></path>
                  <path d="M 552,1392 L 552,1520" fill="none" stroke="black"></path>
                  <path d="M 568,512 L 568,1552" fill="none" stroke="black"></path>
                  <path d="M 568,1600 L 568,1728" fill="none" stroke="black"></path>
                  <path d="M 16,144 L 176,144" fill="none" stroke="black"></path>
                  <path d="M 200,144 L 224,144" fill="none" stroke="black"></path>
                  <path d="M 16,176 L 176,176" fill="none" stroke="black"></path>
                  <path d="M 16,240 L 176,240" fill="none" stroke="black"></path>
                  <path d="M 224,256 L 248,256" fill="none" stroke="black"></path>
                  <path d="M 16,288 L 176,288" fill="none" stroke="black"></path>
                  <path d="M 16,352 L 176,352" fill="none" stroke="black"></path>
                  <path d="M 16,384 L 176,384" fill="none" stroke="black"></path>
                  <path d="M 200,384 L 224,384" fill="none" stroke="black"></path>
                  <path d="M 8,512 L 80,512" fill="none" stroke="black"></path>
                  <path d="M 96,512 L 568,512" fill="none" stroke="black"></path>
                  <path d="M 24,560 L 224,560" fill="none" stroke="black"></path>
                  <path d="M 24,608 L 224,608" fill="none" stroke="black"></path>
                  <path d="M 24,672 L 200,672" fill="none" stroke="black"></path>
                  <path d="M 248,672 L 368,672" fill="none" stroke="black"></path>
                  <path d="M 416,672 L 528,672" fill="none" stroke="black"></path>
                  <path d="M 208,704 L 240,704" fill="none" stroke="black"></path>
                  <path d="M 376,704 L 408,704" fill="none" stroke="black"></path>
                  <path d="M 24,752 L 200,752" fill="none" stroke="black"></path>
                  <path d="M 248,752 L 368,752" fill="none" stroke="black"></path>
                  <path d="M 416,752 L 528,752" fill="none" stroke="black"></path>
                  <path d="M 296,800 L 432,800" fill="none" stroke="black"></path>
                  <path d="M 24,864 L 168,864" fill="none" stroke="black"></path>
                  <path d="M 248,864 L 344,864" fill="none" stroke="black"></path>
                  <path d="M 408,864 L 552,864" fill="none" stroke="black"></path>
                  <path d="M 176,880 L 240,880" fill="none" stroke="black"></path>
                  <path d="M 352,880 L 400,880" fill="none" stroke="black"></path>
                  <path d="M 24,928 L 168,928" fill="none" stroke="black"></path>
                  <path d="M 408,976 L 552,976" fill="none" stroke="black"></path>
                  <path d="M 24,1024 L 192,1024" fill="none" stroke="black"></path>
                  <path d="M 200,1040 L 240,1040" fill="none" stroke="black"></path>
                  <path d="M 248,1056 L 344,1056" fill="none" stroke="black"></path>
                  <path d="M 200,1088 L 248,1088" fill="none" stroke="black"></path>
                  <path d="M 24,1104 L 192,1104" fill="none" stroke="black"></path>
                  <path d="M 416,1152 L 544,1152" fill="none" stroke="black"></path>
                  <path d="M 416,1216 L 544,1216" fill="none" stroke="black"></path>
                  <path d="M 296,1280 L 552,1280" fill="none" stroke="black"></path>
                  <path d="M 296,1328 L 552,1328" fill="none" stroke="black"></path>
                  <path d="M 24,1392 L 176,1392" fill="none" stroke="black"></path>
                  <path d="M 296,1392 L 552,1392" fill="none" stroke="black"></path>
                  <path d="M 248,1424 L 288,1424" fill="none" stroke="black"></path>
                  <path d="M 24,1520 L 176,1520" fill="none" stroke="black"></path>
                  <path d="M 296,1520 L 552,1520" fill="none" stroke="black"></path>
                  <path d="M 8,1552 L 80,1552" fill="none" stroke="black"></path>
                  <path d="M 96,1552 L 568,1552" fill="none" stroke="black"></path>
                  <path d="M 8,1600 L 80,1600" fill="none" stroke="black"></path>
                  <path d="M 96,1600 L 568,1600" fill="none" stroke="black"></path>
                  <path d="M 24,1648 L 480,1648" fill="none" stroke="black"></path>
                  <path d="M 24,1696 L 480,1696" fill="none" stroke="black"></path>
                  <path d="M 8,1728 L 80,1728" fill="none" stroke="black"></path>
                  <path d="M 96,1728 L 568,1728" fill="none" stroke="black"></path>
                  <path d="M 16,1904 L 168,1904" fill="none" stroke="black"></path>
                  <path d="M 16,1936 L 168,1936" fill="none" stroke="black"></path>
                  <path d="M 8,2080 L 80,2080" fill="none" stroke="black"></path>
                  <path d="M 96,2080 L 416,2080" fill="none" stroke="black"></path>
                  <path d="M 24,2128 L 392,2128" fill="none" stroke="black"></path>
                  <path d="M 24,2176 L 392,2176" fill="none" stroke="black"></path>
                  <path d="M 24,2240 L 384,2240" fill="none" stroke="black"></path>
                  <path d="M 24,2288 L 384,2288" fill="none" stroke="black"></path>
                  <path d="M 8,2320 L 80,2320" fill="none" stroke="black"></path>
                  <path d="M 96,2320 L 416,2320" fill="none" stroke="black"></path>
                  <path d="M 16,2496 L 152,2496" fill="none" stroke="black"></path>
                  <path d="M 16,2544 L 152,2544" fill="none" stroke="black"></path>
                  <polygon class="arrowhead" points="520,1272 508,1266.4 508,1277.6" fill="black" transform="rotate(90,512,1272)"></polygon>
                  <polygon class="arrowhead" points="520,1144 508,1138.4 508,1149.6" fill="black" transform="rotate(90,512,1144)"></polygon>
                  <polygon class="arrowhead" points="520,856 508,850.4 508,861.6" fill="black" transform="rotate(90,512,856)"></polygon>
                  <polygon class="arrowhead" points="416,704 404,698.4 404,709.6" fill="black" transform="rotate(0,408,704)"></polygon>
                  <polygon class="arrowhead" points="360,880 348,874.4 348,885.6" fill="black" transform="rotate(180,352,880)"></polygon>
                  <polygon class="arrowhead" points="328,1384 316,1378.4 316,1389.6" fill="black" transform="rotate(90,320,1384)"></polygon>
                  <polygon class="arrowhead" points="328,1064 316,1058.4 316,1069.6" fill="black" transform="rotate(270,320,1064)"></polygon>
                  <polygon class="arrowhead" points="304,856 292,850.4 292,861.6" fill="black" transform="rotate(90,296,856)"></polygon>
                  <polygon class="arrowhead" points="248,1040 236,1034.4 236,1045.6" fill="black" transform="rotate(0,240,1040)"></polygon>
                  <polygon class="arrowhead" points="248,880 236,874.4 236,885.6" fill="black" transform="rotate(0,240,880)"></polygon>
                  <polygon class="arrowhead" points="248,704 236,698.4 236,709.6" fill="black" transform="rotate(0,240,704)"></polygon>
                  <polygon class="arrowhead" points="208,1088 196,1082.4 196,1093.6" fill="black" transform="rotate(180,200,1088)"></polygon>
                  <polygon class="arrowhead" points="96,2488 84,2482.4 84,2493.6" fill="black" transform="rotate(90,88,2488)"></polygon>
                  <polygon class="arrowhead" points="96,2368 84,2362.4 84,2373.6" fill="black" transform="rotate(90,88,2368)"></polygon>
                  <polygon class="arrowhead" points="96,2232 84,2226.4 84,2237.6" fill="black" transform="rotate(90,88,2232)"></polygon>
                  <polygon class="arrowhead" points="96,2120 84,2114.4 84,2125.6" fill="black" transform="rotate(90,88,2120)"></polygon>
                  <polygon class="arrowhead" points="96,1984 84,1978.4 84,1989.6" fill="black" transform="rotate(90,88,1984)"></polygon>
                  <polygon class="arrowhead" points="96,1896 84,1890.4 84,1901.6" fill="black" transform="rotate(90,88,1896)"></polygon>
                  <polygon class="arrowhead" points="96,1776 84,1770.4 84,1781.6" fill="black" transform="rotate(90,88,1776)"></polygon>
                  <polygon class="arrowhead" points="96,1640 84,1634.4 84,1645.6" fill="black" transform="rotate(90,88,1640)"></polygon>
                  <polygon class="arrowhead" points="96,1384 84,1378.4 84,1389.6" fill="black" transform="rotate(90,88,1384)"></polygon>
                  <polygon class="arrowhead" points="96,1016 84,1010.4 84,1021.6" fill="black" transform="rotate(90,88,1016)"></polygon>
                  <polygon class="arrowhead" points="96,856 84,850.4 84,861.6" fill="black" transform="rotate(90,88,856)"></polygon>
                  <polygon class="arrowhead" points="96,664 84,658.4 84,669.6" fill="black" transform="rotate(90,88,664)"></polygon>
                  <polygon class="arrowhead" points="96,344 84,338.4 84,349.6" fill="black" transform="rotate(90,88,344)"></polygon>
                  <polygon class="arrowhead" points="96,232 84,226.4 84,237.6" fill="black" transform="rotate(90,88,232)"></polygon>
                  <polygon class="arrowhead" points="96,136 84,130.4 84,141.6" fill="black" transform="rotate(90,88,136)"></polygon>
                  <g class="text">
                    <text x="52" y="36">Incoming</text>
                    <text x="40" y="52">EDHOC</text>
                    <text x="104" y="52">message_X</text>
                    <text x="28" y="68">(X</text>
                    <text x="48" y="68">=</text>
                    <text x="64" y="68">2</text>
                    <text x="84" y="68">or</text>
                    <text x="108" y="68">3)</text>
                    <text x="52" y="164">Decode</text>
                    <text x="120" y="164">message_X</text>
                    <text x="60" y="260">Retrieve</text>
                    <text x="112" y="260">the</text>
                    <text x="280" y="260">(Core</text>
                    <text x="328" y="260">EDHOC</text>
                    <text x="400" y="260">Processing)</text>
                    <text x="60" y="276">protocol</text>
                    <text x="120" y="276">state</text>
                    <text x="56" y="372">Decrypt</text>
                    <text x="128" y="372">message_X</text>
                    <text x="40" y="452">Control</text>
                    <text x="120" y="452">transferred</text>
                    <text x="180" y="452">to</text>
                    <text x="24" y="468">the</text>
                    <text x="100" y="468">side-processor</text>
                    <text x="188" y="468">object</text>
                    <text x="260" y="532">Pre-verification</text>
                    <text x="348" y="532">side</text>
                    <text x="412" y="532">processing</text>
                    <text x="496" y="532">(PHASE_1)</text>
                    <text x="56" y="580">Check</text>
                    <text x="112" y="580">whether</text>
                    <text x="180" y="580">expected</text>
                    <text x="48" y="596">EAD</text>
                    <text x="88" y="596">items</text>
                    <text x="128" y="596">are</text>
                    <text x="172" y="596">absent</text>
                    <text x="44" y="692">1.</text>
                    <text x="76" y="692">Does</text>
                    <text x="136" y="692">ID_CRED_X</text>
                    <text x="220" y="692">NO</text>
                    <text x="268" y="692">3.</text>
                    <text x="316" y="692">Retrieve</text>
                    <text x="436" y="692">4.</text>
                    <text x="460" y="692">Is</text>
                    <text x="488" y="692">the</text>
                    <text x="44" y="708">or</text>
                    <text x="68" y="708">an</text>
                    <text x="96" y="708">EAD</text>
                    <text x="132" y="708">item</text>
                    <text x="276" y="708">CRED</text>
                    <text x="312" y="708">via</text>
                    <text x="464" y="708">retrieval</text>
                    <text x="56" y="724">point</text>
                    <text x="92" y="724">to</text>
                    <text x="116" y="724">an</text>
                    <text x="160" y="724">already</text>
                    <text x="296" y="724">ID_CRED_X</text>
                    <text x="348" y="724">or</text>
                    <text x="436" y="724">of</text>
                    <text x="468" y="724">CRED</text>
                    <text x="60" y="740">stored</text>
                    <text x="112" y="740">CRED?</text>
                    <text x="268" y="740">an</text>
                    <text x="296" y="740">EAD</text>
                    <text x="332" y="740">item</text>
                    <text x="472" y="740">successful?</text>
                    <text x="452" y="788">NO</text>
                    <text x="536" y="788">YES</text>
                    <text x="112" y="836">YES</text>
                    <text x="188" y="868">NO</text>
                    <text x="384" y="868">YES</text>
                    <text x="44" y="884">2.</text>
                    <text x="68" y="884">Is</text>
                    <text x="100" y="884">this</text>
                    <text x="140" y="884">CRED</text>
                    <text x="272" y="884">11.</text>
                    <text x="312" y="884">Abort</text>
                    <text x="428" y="884">5.</text>
                    <text x="452" y="884">Is</text>
                    <text x="480" y="884">the</text>
                    <text x="520" y="884">trust</text>
                    <text x="56" y="900">still</text>
                    <text x="104" y="900">valid</text>
                    <text x="144" y="900">and</text>
                    <text x="272" y="900">the</text>
                    <text x="312" y="900">EDHOC</text>
                    <text x="444" y="900">policy</text>
                    <text x="492" y="900">used</text>
                    <text x="68" y="916">trusted?</text>
                    <text x="288" y="916">session</text>
                    <text x="476" y="916">"NO-LEARNING",</text>
                    <text x="448" y="932">without</text>
                    <text x="496" y="932">any</text>
                    <text x="460" y="948">acceptable</text>
                    <text x="464" y="964">exceptions?</text>
                    <text x="112" y="996">YES</text>
                    <text x="404" y="1012">Here</text>
                    <text x="440" y="1012">the</text>
                    <text x="480" y="1012">trust</text>
                    <text x="532" y="1012">NO</text>
                    <text x="212" y="1028">NO</text>
                    <text x="412" y="1028">policy</text>
                    <text x="460" y="1028">used</text>
                    <text x="492" y="1028">is</text>
                    <text x="44" y="1044">9.</text>
                    <text x="68" y="1044">Is</text>
                    <text x="100" y="1044">this</text>
                    <text x="140" y="1044">CRED</text>
                    <text x="432" y="1044">"LEARNING",</text>
                    <text x="492" y="1044">or</text>
                    <text x="52" y="1060">good</text>
                    <text x="84" y="1060">to</text>
                    <text x="112" y="1060">use</text>
                    <text x="140" y="1060">in</text>
                    <text x="168" y="1060">the</text>
                    <text x="440" y="1060">"NO-LEARNING"</text>
                    <text x="64" y="1076">context</text>
                    <text x="108" y="1076">of</text>
                    <text x="140" y="1076">this</text>
                    <text x="420" y="1076">together</text>
                    <text x="476" y="1076">with</text>
                    <text x="56" y="1092">EDHOC</text>
                    <text x="116" y="1092">session?</text>
                    <text x="396" y="1092">an</text>
                    <text x="452" y="1092">overriding</text>
                    <text x="424" y="1108">exception</text>
                    <text x="436" y="1172">6.</text>
                    <text x="476" y="1172">Assess</text>
                    <text x="516" y="1172">if</text>
                    <text x="444" y="1188">CRED</text>
                    <text x="476" y="1188">is</text>
                    <text x="512" y="1188">valid</text>
                    <text x="440" y="1204">and</text>
                    <text x="488" y="1204">trusted</text>
                    <text x="112" y="1252">YES</text>
                    <text x="340" y="1252">NO</text>
                    <text x="316" y="1300">7.</text>
                    <text x="340" y="1300">Is</text>
                    <text x="372" y="1300">CRED</text>
                    <text x="416" y="1300">valid</text>
                    <text x="456" y="1300">and</text>
                    <text x="368" y="1316">(provisionally)</text>
                    <text x="468" y="1316">trusted?</text>
                    <text x="344" y="1364">YES</text>
                    <text x="48" y="1412">10.</text>
                    <text x="100" y="1412">Continue</text>
                    <text x="148" y="1412">by</text>
                    <text x="316" y="1412">8.</text>
                    <text x="352" y="1412">Store</text>
                    <text x="396" y="1412">CRED</text>
                    <text x="428" y="1412">as</text>
                    <text x="464" y="1412">valid</text>
                    <text x="504" y="1412">and</text>
                    <text x="80" y="1428">considering</text>
                    <text x="148" y="1428">this</text>
                    <text x="368" y="1428">(provisionally)</text>
                    <text x="468" y="1428">trusted.</text>
                    <text x="52" y="1444">CRED</text>
                    <text x="84" y="1444">as</text>
                    <text x="112" y="1444">the</text>
                    <text x="92" y="1460">authentication</text>
                    <text x="324" y="1460">Pair</text>
                    <text x="364" y="1460">CRED</text>
                    <text x="404" y="1460">with</text>
                    <text x="468" y="1460">consistent</text>
                    <text x="76" y="1476">credential</text>
                    <text x="348" y="1476">credential</text>
                    <text x="444" y="1476">identifiers,</text>
                    <text x="512" y="1476">for</text>
                    <text x="76" y="1492">associated</text>
                    <text x="140" y="1492">with</text>
                    <text x="324" y="1492">each</text>
                    <text x="384" y="1492">supported</text>
                    <text x="444" y="1492">type</text>
                    <text x="476" y="1492">of</text>
                    <text x="48" y="1508">the</text>
                    <text x="88" y="1508">other</text>
                    <text x="132" y="1508">peer</text>
                    <text x="348" y="1508">credential</text>
                    <text x="440" y="1508">identifier.</text>
                    <text x="252" y="1620">Pre-verification</text>
                    <text x="340" y="1620">side</text>
                    <text x="404" y="1620">processing</text>
                    <text x="488" y="1620">(PHASE_2)</text>
                    <text x="64" y="1668">Process</text>
                    <text x="112" y="1668">the</text>
                    <text x="144" y="1668">EAD</text>
                    <text x="184" y="1668">items</text>
                    <text x="228" y="1668">that</text>
                    <text x="268" y="1668">have</text>
                    <text x="304" y="1668">not</text>
                    <text x="340" y="1668">been</text>
                    <text x="400" y="1668">processed</text>
                    <text x="456" y="1668">yet</text>
                    <text x="48" y="1684">and</text>
                    <text x="84" y="1684">that</text>
                    <text x="120" y="1684">can</text>
                    <text x="148" y="1684">be</text>
                    <text x="200" y="1684">processed</text>
                    <text x="268" y="1684">before</text>
                    <text x="328" y="1684">message</text>
                    <text x="412" y="1684">verification</text>
                    <text x="40" y="1812">Control</text>
                    <text x="120" y="1812">transferred</text>
                    <text x="188" y="1812">back</text>
                    <text x="20" y="1828">to</text>
                    <text x="48" y="1828">the</text>
                    <text x="84" y="1828">core</text>
                    <text x="128" y="1828">EDHOC</text>
                    <text x="196" y="1828">processing</text>
                    <text x="52" y="1924">Verify</text>
                    <text x="120" y="1924">message_X</text>
                    <text x="200" y="1924">(Core</text>
                    <text x="248" y="1924">EDHOC</text>
                    <text x="320" y="1924">processing)</text>
                    <text x="40" y="2020">Control</text>
                    <text x="120" y="2020">transferred</text>
                    <text x="180" y="2020">to</text>
                    <text x="24" y="2036">the</text>
                    <text x="100" y="2036">side-processor</text>
                    <text x="188" y="2036">object</text>
                    <text x="248" y="2100">Post-verification</text>
                    <text x="364" y="2100">processing</text>
                    <text x="64" y="2148">Process</text>
                    <text x="112" y="2148">the</text>
                    <text x="144" y="2148">EAD</text>
                    <text x="184" y="2148">items</text>
                    <text x="228" y="2148">that</text>
                    <text x="268" y="2148">have</text>
                    <text x="300" y="2148">to</text>
                    <text x="324" y="2148">be</text>
                    <text x="72" y="2164">processed</text>
                    <text x="140" y="2164">(also)</text>
                    <text x="192" y="2164">after</text>
                    <text x="248" y="2164">message</text>
                    <text x="332" y="2164">verification</text>
                    <text x="52" y="2260">Make</text>
                    <text x="88" y="2260">all</text>
                    <text x="120" y="2260">the</text>
                    <text x="168" y="2260">results</text>
                    <text x="212" y="2260">of</text>
                    <text x="240" y="2260">the</text>
                    <text x="272" y="2260">EAD</text>
                    <text x="332" y="2260">processing</text>
                    <text x="72" y="2276">available</text>
                    <text x="124" y="2276">to</text>
                    <text x="160" y="2276">build</text>
                    <text x="200" y="2276">the</text>
                    <text x="236" y="2276">next</text>
                    <text x="280" y="2276">EDHOC</text>
                    <text x="336" y="2276">message</text>
                    <text x="40" y="2404">Control</text>
                    <text x="120" y="2404">transferred</text>
                    <text x="188" y="2404">back</text>
                    <text x="20" y="2420">to</text>
                    <text x="48" y="2420">the</text>
                    <text x="84" y="2420">core</text>
                    <text x="128" y="2420">EDHOC</text>
                    <text x="196" y="2420">processing</text>
                    <text x="56" y="2516">Advance</text>
                    <text x="104" y="2516">the</text>
                    <text x="184" y="2516">(Core</text>
                    <text x="232" y="2516">EDHOC</text>
                    <text x="304" y="2516">processing)</text>
                    <text x="60" y="2532">protocol</text>
                    <text x="120" y="2532">state</text>
                  </g>
                </svg><a href="#section-4.3.3-4.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-processing-steps-for-edhoc-" class="selfRef">Processing Steps for EDHOC message_2 and message_3.</a>
            </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="sec-consistency-checks-auth-creds">
<section id="section-4.4">
        <h3 id="name-consistency-checks-of-authe">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-consistency-checks-of-authe" class="section-name selfRef">Consistency Checks of Authentication Credentials from ID_CRED and EAD Items</a>
        </h3>
<p id="section-4.4-1">Typically, an EDHOC peer specifies its associated authentication credential (by value or by reference) only in the ID_CRED field of EDHOC message_2 (if acting as Responder) or EDHOC message_3 (if acting as Initiator).<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">In addition to that, there may be cases where an EDHOC peer provides the authentication credential also in an EAD item. In particular, such an EAD item can specify a cryptographically protected "envelope" (by value or by reference), which in turn specifies the authentication credential (by value or by reference).<a href="#section-4.4-2" class="pilcrow">¶</a></p>
<p id="section-4.4-3">A case in point is the EDHOC and OSCORE profile of the ACE framework <span>[<a href="#I-D.ietf-ace-edhoc-oscore-profile" class="cite xref">I-D.ietf-ace-edhoc-oscore-profile</a>]</span>, where the envelope in question is an access token issued to the ACE client. In such a case, the ACE client can rely on an EAD item specifying the access token by value, or instead on a different EAD item specifying a session identifier as a reference to such access token. In either case, the access token specifies the authentication credential (by value or by reference) associated with the client.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<p id="section-4.4-4">During an EDHOC session, an EDHOC peer P1 might therefore receive the authentication credential CRED associated with the other EDHOC peer P2 as specified by two items:<a href="#section-4.4-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-5.1">
            <p id="section-4.4-5.1.1">ITEM_A: the ID_CRED field specifying CRED. If P2 acts as Initiator (Responder), then ITEM_A is the ID_CRED_I (ID_CRED_R) field.<a href="#section-4.4-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.4-5.2">
            <p id="section-4.4-5.2.1">ITEM_B: the envelope specified in an EAD item within an EDHOC message sent by P2.<a href="#section-4.4-5.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.4-6">As part of the process where P1 validates CRED during the EDHOC session, P1 must check that both ITEM_A and ITEM_B specify the same authentication credential, and it must abort the EDHOC session if such a consistency check fails.<a href="#section-4.4-6" class="pilcrow">¶</a></p>
<p id="section-4.4-7">The consistency check is successful only if one of the following conditions holds, and it fails otherwise:<a href="#section-4.4-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-8.1">
            <p id="section-4.4-8.1.1">If both ITEM_A and ITEM_B specify an authentication credential by value, then both ITEM_A and ITEM_B specify the same value.<a href="#section-4.4-8.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.4-8.2">
            <p id="section-4.4-8.2.1">If one among ITEM_A and ITEM_B specifies an authentication credential by value VALUE while the other one specifies an authentication credential by reference REF, then REF is a valid reference for VALUE.<a href="#section-4.4-8.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.4-8.3">
            <p id="section-4.4-8.3.1">If ITEM_A specifies an authentication credential by reference REF_A and ITEM_B specifies an authentication credential by reference REF_B, then REF_A or REF_B allows to retrieving the value VALUE of an authentication credential from a local or remote storage, such that both REF_A and REF_B are a valid reference for VALUE.<a href="#section-4.4-8.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.4-9">The peer P1 performs the consistency check above as soon as it has both ITEM_A and ITEM_B available. If P1 acts as Responder, that is the case when processing the incoming EDHOC message_3. If P1 acts as Initiator, that is the case when processing the incoming EDHOC message_2 or message_4, i.e., whichever of the two messages includes ITEM_B in an EAD item of its EAD field.<a href="#section-4.4-9" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-block-wise">
<section id="section-5">
      <h2 id="name-using-edhoc-over-coap-with-">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-using-edhoc-over-coap-with-" class="section-name selfRef">Using EDHOC over CoAP with Block-Wise</a>
      </h2>
<p id="section-5-1"><span><a href="https://rfc-editor.org/rfc/rfc9528#appendix-A.2" class="relref">Appendix A.2</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span> specifies how to transfer EDHOC over CoAP <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>. In such a case, EDHOC messages (possibly prepended by an EDHOC connection identifier) are transported in the payload of CoAP requests and responses, according to the EDHOC forward message flow or the EDHOC reverse message flow. Furthermore, <span><a href="https://rfc-editor.org/rfc/rfc9528#appendix-A.1" class="relref">Appendix A.1</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span> specifies how to derive an OSCORE Security Context <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> from an EDHOC session.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">Building on that, <span>[<a href="#RFC9668" class="cite xref">RFC9668</a>]</span> further details the use of EDHOC with CoAP and OSCORE. In particular, it specifies an optimization approach for the EDHOC forward message flow that combines the EDHOC execution with the first subsequent OSCORE transaction. This is achieved by means of an "EDHOC + OSCORE request", i.e., a single CoAP request message that conveys both EDHOC message_3 of the ongoing EDHOC session and the OSCORE-protected application data, where the latter is protected with the OSCORE Security Context derived from that EDHOC session.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">This section provides guidelines and recommendations for CoAP endpoints supporting Block-wise transfers for CoAP <span>[<a href="#RFC7959" class="cite xref">RFC7959</a>]</span> and specifically for CoAP clients supporting the EDHOC + OSCORE request defined in <span>[<a href="#RFC9668" class="cite xref">RFC9668</a>]</span>. The use of Block-wise transfers can be desirable, e.g., for EDHOC messages that include a large ID_CRED_I or ID_CRED_R, or that include a large EAD field.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">The following especially considers a CoAP endpoint that may perform only "inner" Block-wise, but not "outer" Block-wise operations (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-4.1.3.4" class="relref">Section 4.1.3.4</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>). That is, the considered CoAP endpoint does not (further) split an OSCORE-protected message like an intermediary (e.g., a proxy) might do. This is the typical case for CoAP endpoints using OSCORE (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-4.1.3.4" class="relref">Section 4.1.3.4</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>).<a href="#section-5-4" class="pilcrow">¶</a></p>
<div id="notation">
<section id="section-5.1">
        <h3 id="name-notation">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-notation" class="section-name selfRef">Notation</a>
        </h3>
<p id="section-5.1-1">The rest of this section refers to the following notation:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-2.1">
            <p id="section-5.1-2.1.1">SIZE_BODY: the size in bytes of the data to be transmitted with CoAP. When Block-wise is used, such data is referred to as the "body" to be fragmented into blocks, each of which to be transmitted in one CoAP message.<a href="#section-5.1-2.1.1" class="pilcrow">¶</a></p>
<p id="section-5.1-2.1.2">
With the exception pertaining to EDHOC message_3 described in the following paragraph, the considered body can in general be an EDHOC message, possibly prepended by an EDHOC connection identifier encoded as per <span><a href="https://rfc-editor.org/rfc/rfc9528#section-3.3" class="relref">Section 3.3</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>.<a href="#section-5.1-2.1.2" class="pilcrow">¶</a></p>
<p id="section-5.1-2.1.3">
When specifically using the EDHOC + OSCORE request, the considered body is the application data to be protected with OSCORE, (whose first block is) to be sent together with EDHOC message_3 as part of the EDHOC + OSCORE request.<a href="#section-5.1-2.1.3" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-2.2">
            <p id="section-5.1-2.2.1">SIZE_EDHOC_M3: the size in bytes of EDHOC message_3, if this is sent as part of the EDHOC + OSCORE request. Otherwise, the size in bytes of EDHOC message_3, plus, if included, the size in bytes of a prepended EDHOC connection identifier encoded as per <span><a href="https://rfc-editor.org/rfc/rfc9528#section-3.3" class="relref">Section 3.3</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>.<a href="#section-5.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-2.3">
            <p id="section-5.1-2.3.1">SIZE_MTU: the maximum amount of transmittable bytes before having to use Block-wise. This is, for example, 64 KiB as maximum datagram size when using UDP, or 1280 bytes as the maximum size for an IPv6 MTU.<a href="#section-5.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-2.4">
            <p id="section-5.1-2.4.1">SIZE_OH: the size in bytes of the overall overhead due to all the communication layers underlying the application. This takes into account also the overhead introduced by the OSCORE processing.<a href="#section-5.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-2.5">
            <p id="section-5.1-2.5.1">LIMIT = (SIZE_MTU - SIZE_OH): the practical maximum size in bytes to be considered by the application before using Block-wise.<a href="#section-5.1-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-2.6">
            <p id="section-5.1-2.6.1">SIZE_BLOCK: the size in bytes of inner blocks.<a href="#section-5.1-2.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-2.7">
            <p id="section-5.1-2.7.1">ceil(): the ceiling function.<a href="#section-5.1-2.7.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-block-wise-pre-req">
<section id="section-5.2">
        <h3 id="name-pre-requirements-for-the-ed">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-pre-requirements-for-the-ed" class="section-name selfRef">Pre-requirements for the EDHOC + OSCORE Request</a>
        </h3>
<p id="section-5.2-1">Before sending an EDHOC + OSCORE request, a CoAP client has to perform the following checks. Note that, while the CoAP client is able to fragment the plain application data before any OSCORE processing, it cannot fragment the EDHOC + OSCORE request or the EDHOC message_3 added therein.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-2.1">
            <p id="section-5.2-2.1.1">If inner Block-wise is not used, hence SIZE_BODY &lt;= LIMIT, the CoAP client must verify whether all the following conditions hold:<a href="#section-5.2-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-2.1.2.1">
                <p id="section-5.2-2.1.2.1.1">COND1: SIZE_EDHOC_M3 &lt;= LIMIT<a href="#section-5.2-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-5.2-2.1.2.2">
                <p id="section-5.2-2.1.2.2.1">COND2: (SIZE_BODY + SIZE_EDHOC_M3) &lt;= LIMIT<a href="#section-5.2-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-5.2-2.2">
            <p id="section-5.2-2.2.1">If inner Block-wise is used, the CoAP client must verify whether all the following conditions hold:<a href="#section-5.2-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-2.2.2.1">
                <p id="section-5.2-2.2.2.1.1">COND3: SIZE_EDHOC_M3 &lt;= LIMIT<a href="#section-5.2-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-5.2-2.2.2.2">
                <p id="section-5.2-2.2.2.2.1">COND4: (SIZE_BLOCK + SIZE_EDHOC_M3) &lt;= LIMIT<a href="#section-5.2-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-5.2-3">In either case, if not all the corresponding conditions hold, the CoAP client should not send the EDHOC + OSCORE request. Instead, the CoAP client can continue by switching to the purely sequential, original EDHOC workflow (see <span><a href="https://rfc-editor.org/rfc/rfc9528#appendix-A.2.1" class="relref">Appendix A.2.1</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>). That is, the CoAP client first sends EDHOC message_3 prepended by the EDHOC Connection Identifier C_R encoded as per <span><a href="https://rfc-editor.org/rfc/rfc9528#section-3.3" class="relref">Section 3.3</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span> and then sends the OSCORE-protected CoAP request once the EDHOC execution is completed.<a href="#section-5.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="effectively-using-block-wise">
<section id="section-5.3">
        <h3 id="name-effectively-using-block-wis">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-effectively-using-block-wis" class="section-name selfRef">Effectively Using Block-Wise</a>
        </h3>
<p id="section-5.3-1">In order to avoid further fragmentation at lower layers when sending an EDHOC + OSCORE request, the CoAP client has to use inner Block-wise if <em>any</em> of the following conditions holds:<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3-2.1">
            <p id="section-5.3-2.1.1">COND5: SIZE_BODY &gt; LIMIT<a href="#section-5.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.3-2.2">
            <p id="section-5.3-2.2.1">COND6: (SIZE_BODY + SIZE_EDHOC_M3) &gt; LIMIT<a href="#section-5.3-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.3-3">In particular, consistently with <a href="#sec-block-wise-pre-req" class="auto internal xref">Section 5.2</a>, the SIZE_BLOCK used has to be such that the following condition also holds:<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3-4.1">
            <p id="section-5.3-4.1.1">COND7: (SIZE_BLOCK + SIZE_EDHOC_M3) &lt;= LIMIT<a href="#section-5.3-4.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.3-5">Note that the CoAP client might still use Block-wise due to reasons different from exceeding the size indicated by LIMIT.<a href="#section-5.3-5" class="pilcrow">¶</a></p>
<p id="section-5.3-6">The following shows the number of round trips for completing both the EDHOC execution and the first OSCORE-protected exchange, under the assumption that the exchange of EDHOC message_1 and EDHOC message_2 does not result in using Block-wise.<a href="#section-5.3-6" class="pilcrow">¶</a></p>
<p id="section-5.3-7">If <em>both</em> the conditions COND5 and COND6 hold, the use of Block-wise results in the following number of round trips experienced by the CoAP client.<a href="#section-5.3-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3-8.1">
            <p id="section-5.3-8.1.1">If the original EDHOC execution workflow is used (see <span><a href="https://rfc-editor.org/rfc/rfc9528#appendix-A.2.1" class="relref">Appendix A.2.1</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>), the number of round trips RT_ORIG is equal to 1 + ceil(SIZE_EDHOC_M3 / SIZE_BLOCK) + ceil(SIZE_BODY / SIZE_BLOCK).<a href="#section-5.3-8.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.3-8.2">
            <p id="section-5.3-8.2.1">If the optimized EDHOC execution workflow is used (see <span><a href="https://rfc-editor.org/rfc/rfc9668#section-3" class="relref">Section 3</a> of [<a href="#RFC9668" class="cite xref">RFC9668</a>]</span>), the number of round trips RT_COMB is equal to 1 + ceil(SIZE_BODY / SIZE_BLOCK).<a href="#section-5.3-8.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.3-9">It follows that RT_COMB &lt; RT_ORIG, i.e., the optimized EDHOC execution workflow always yields a lower number of round trips.<a href="#section-5.3-9" class="pilcrow">¶</a></p>
<p id="section-5.3-10">Instead, the convenience of using the optimized EDHOC execution workflow becomes questionable if <em>both</em> the following conditions hold:<a href="#section-5.3-10" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3-11.1">
            <p id="section-5.3-11.1.1">COND8: SIZE_BODY &lt;= LIMIT<a href="#section-5.3-11.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.3-11.2">
            <p id="section-5.3-11.2.1">COND9: (SIZE_BODY + SIZE_EDHOC_M3) &gt; LIMIT<a href="#section-5.3-11.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.3-12">That is, since SIZE_BODY &lt;= LIMIT, using Block-wise would not be required when using the original EDHOC execution workflow, provided that SIZE_EDHOC_M3 &lt;= LIMIT still holds.<a href="#section-5.3-12" class="pilcrow">¶</a></p>
<p id="section-5.3-13">At the same time, using the combined workflow is in itself what actually triggers the use of Block-wise, since (SIZE_BODY + SIZE_EDHOC_M3) &gt; LIMIT.<a href="#section-5.3-13" class="pilcrow">¶</a></p>
<p id="section-5.3-14">Therefore, the following round trips are experienced by the CoAP client.<a href="#section-5.3-14" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3-15.1">
            <p id="section-5.3-15.1.1">The original EDHOC execution workflow run without using Block-wise results in a number of round trips RT_ORIG equal to 3.<a href="#section-5.3-15.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.3-15.2">
            <p id="section-5.3-15.2.1">The optimized EDHOC execution workflow run using Block-wise results in a number of round trips RT_COMB equal to 1 + ceil(SIZE_BODY / SIZE_BLOCK).<a href="#section-5.3-15.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.3-16">It follows that RT_COMB &gt;= RT_ORIG, i.e., the optimized EDHOC execution workflow might still be not worse than the original EDHOC execution workflow in terms of round trips. This is the case only if the SIZE_BLOCK used is such that ceil(SIZE_BODY / SIZE_BLOCK) is equal to 2, i.e., the plain application data is fragmented into only 2 inner blocks, and thus the EDHOC + OSCORE request is followed by only one more request message transporting the last block of the body.<a href="#section-5.3-16" class="pilcrow">¶</a></p>
<p id="section-5.3-17">However, even in such a case, there would be no advantage in terms or round trips compared to the original workflow, while still requiring the CoAP client and the CoAP server to perform the processing due to using the EDHOC + OSCORE request and Block-wise transferring.<a href="#section-5.3-17" class="pilcrow">¶</a></p>
<p id="section-5.3-18">Therefore, if both the conditions COND8 and COND9 hold, the CoAP client should not send the EDHOC + OSCORE request. Instead, the CoAP client should continue by switching to the original EDHOC execution workflow. That is, the CoAP client first sends EDHOC message_3 prepended by the EDHOC Connection Identifier C_R encoded as per <span><a href="https://rfc-editor.org/rfc/rfc9528#section-3.3" class="relref">Section 3.3</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span> and then sends the OSCORE-protected CoAP request once the EDHOC execution is completed.<a href="#section-5.3-18" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="operational-considerations">
<section id="section-6">
      <h2 id="name-operational-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-operational-considerations" class="section-name selfRef">Operational Considerations</a>
      </h2>
<p id="section-6-1">There are no new operations or manageability requirements introduced by this document.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">Explanation: this document provides considerations for implementers of the EDHOC protocol, without updating the protocol or introducing extensions thereof.<a href="#section-6-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-security-considerations">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-7-1">This document provides considerations for implementations of the EDHOC protocol. The security considerations compiled in <span><a href="https://rfc-editor.org/rfc/rfc9528#section-9" class="relref">Section 9</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span> and in <span><a href="https://rfc-editor.org/rfc/rfc9668#section-7" class="relref">Section 7</a> of [<a href="#RFC9668" class="cite xref">RFC9668</a>]</span> apply. The compliance requirements for implementations that are listed in <span><a href="https://rfc-editor.org/rfc/rfc9528#section-8" class="relref">Section 8</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span> also apply.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">It is foreseeable that the EDHOC protocol will be extended (e.g., in terms of new cipher suites, new methods, and new types of authentication credentials) and that external security applications will be integrated into EDHOC by embedding the transport of their data in EDHOC EAD items. For implementations that support such extensions and external applications, the related security considerations and compliance requirements also apply.<a href="#section-7-2" class="pilcrow">¶</a></p>
<div id="assessing-the-correctness-of-implementations">
<section id="section-7.1">
        <h3 id="name-assessing-the-correctness-o">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-assessing-the-correctness-o" class="section-name selfRef">Assessing the Correctness of Implementations</a>
        </h3>
<p id="section-7.1-1">Tools relying on fuzz testing such as EDHOC-Fuzzer <span>[<a href="#EDHOC-Fuzzer" class="cite xref">EDHOC-Fuzzer</a>]</span> can help assess the correctness of implementations of the EDHOC protocol and of external security applications integrated into EDHOC.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">Such tools help finding and amending implementation errors especially related to the following points:<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1-3.1">
            <p id="section-7.1-3.1.1">Non-conformance with the protocol specification (e.g., unintended deviations in performing the protocol steps), which can be a potential source of security vulnerabilities in addition to performance deficiencies.<a href="#section-7.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.1-3.2">
            <p id="section-7.1-3.2.1">Presence of inappropriate states and state transitions in the modeling of the EDHOC execution, e.g., states that are impossible to reach and traverse or that are not part of the protocol specification (which is a particular case of non-conformance).<a href="#section-7.1-3.2.1" class="pilcrow">¶</a></p>
<p id="section-7.1-3.2.2">
These states and transitions should be amended or removed, in order to reduce the memory footprint and code complexity and to simplify the implementation, thus reducing the risks of bugs and related security vulnerabilities.<a href="#section-7.1-3.2.2" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-8-1">This document has no actions for IANA.<a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-combined-references">
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC7252">[RFC7252]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span>, <span class="refAuthor">Hartke, K.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7252">https://www.rfc-editor.org/rfc/rfc7252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7959">[RFC7959]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">Z. Shelby, Ed.</span>, <span class="refTitle">"Block-Wise Transfers in the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7959</span>, <span class="seriesInfo">DOI 10.17487/RFC7959</span>, <time datetime="2016-08" class="refDate">August 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7959">https://www.rfc-editor.org/rfc/rfc7959</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8613">[RFC8613]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J.</span>, <span class="refAuthor">Palombini, F.</span>, and <span class="refAuthor">L. Seitz</span>, <span class="refTitle">"Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="seriesInfo">RFC 8613</span>, <span class="seriesInfo">DOI 10.17487/RFC8613</span>, <time datetime="2019-07" class="refDate">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8613">https://www.rfc-editor.org/rfc/rfc8613</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9528">[RFC9528]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Preuß Mattsson, J.</span>, and <span class="refAuthor">F. Palombini</span>, <span class="refTitle">"Ephemeral Diffie-Hellman Over COSE (EDHOC)"</span>, <span class="seriesInfo">RFC 9528</span>, <span class="seriesInfo">DOI 10.17487/RFC9528</span>, <time datetime="2024-03" class="refDate">March 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9528">https://www.rfc-editor.org/rfc/rfc9528</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9668">[RFC9668]</dt>
      <dd>
<span class="refAuthor">Palombini, F.</span>, <span class="refAuthor">Tiloca, M.</span>, <span class="refAuthor">Höglund, R.</span>, <span class="refAuthor">Hristozov, S.</span>, and <span class="refAuthor">G. Selander</span>, <span class="refTitle">"Using Ephemeral Diffie-Hellman Over COSE (EDHOC) with the Constrained Application Protocol (CoAP) and Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="seriesInfo">RFC 9668</span>, <span class="seriesInfo">DOI 10.17487/RFC9668</span>, <time datetime="2024-11" class="refDate">November 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9668">https://www.rfc-editor.org/rfc/rfc9668</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="EDHOC-Fuzzer">[EDHOC-Fuzzer]</dt>
        <dd>
<span class="refAuthor">Sagonas, K.</span> and <span class="refAuthor">T. Typaldos</span>, <span class="refTitle">"EDHOC-Fuzzer: An EDHOC Protocol State Fuzzer"</span>, <span class="seriesInfo">ISSTA 2023: Proceedings of the 32nd ACM SIGSOFT International Symposium on Software Testing and Analysis </span>, <time datetime="2023-07-13" class="refDate">13 July 2023</time>, <span>&lt;<a href="https://dl.acm.org/doi/10.1145/3597926.3604922">https://dl.acm.org/doi/10.1145/3597926.3604922</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-edhoc-oscore-profile">[I-D.ietf-ace-edhoc-oscore-profile]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J. P.</span>, <span class="refAuthor">Tiloca, M.</span>, and <span class="refAuthor">R. Höglund</span>, <span class="refTitle">"Ephemeral Diffie-Hellman Over COSE (EDHOC) and Object Security for Constrained Environments (OSCORE) Profile for Authentication and Authorization for Constrained Environments (ACE)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-edhoc-oscore-profile-09</span>, <time datetime="2025-10-20" class="refDate">20 October 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-edhoc-oscore-profile-09">https://datatracker.ietf.org/doc/html/draft-ietf-ace-edhoc-oscore-profile-09</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-workflow-and-params">[I-D.ietf-ace-workflow-and-params]</dt>
        <dd>
<span class="refAuthor">Tiloca, M.</span> and <span class="refAuthor">G. Selander</span>, <span class="refTitle">"Short Distribution Chain (SDC) Workflow and New OAuth Parameters for the Authentication and Authorization for Constrained Environments (ACE) Framework"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-workflow-and-params-06</span>, <time datetime="2025-10-20" class="refDate">20 October 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-workflow-and-params-06">https://datatracker.ietf.org/doc/html/draft-ietf-ace-workflow-and-params-06</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-oscore-key-limits">[I-D.ietf-core-oscore-key-limits]</dt>
        <dd>
<span class="refAuthor">Höglund, R.</span> and <span class="refAuthor">M. Tiloca</span>, <span class="refTitle">"Key Usage Limits for OSCORE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-oscore-key-limits-06</span>, <time datetime="2026-01-07" class="refDate">7 January 2026</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-key-limits-06">https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-key-limits-06</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-oscore-key-update">[I-D.ietf-core-oscore-key-update]</dt>
        <dd>
<span class="refAuthor">Höglund, R.</span> and <span class="refAuthor">M. Tiloca</span>, <span class="refTitle">"Key Update for OSCORE (KUDOS)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-oscore-key-update-12</span>, <time datetime="2025-10-20" class="refDate">20 October 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-key-update-12">https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-key-update-12</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-cose-cbor-encoded-cert">[I-D.ietf-cose-cbor-encoded-cert]</dt>
        <dd>
<span class="refAuthor">Mattsson, J. P.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Raza, S.</span>, <span class="refAuthor">Höglund, J.</span>, and <span class="refAuthor">M. Furuhed</span>, <span class="refTitle">"CBOR Encoded X.509 Certificates (C509 Certificates)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-cose-cbor-encoded-cert-16</span>, <time datetime="2026-01-25" class="refDate">25 January 2026</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-cose-cbor-encoded-cert-16">https://datatracker.ietf.org/doc/html/draft-ietf-cose-cbor-encoded-cert-16</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-lake-authz">[I-D.ietf-lake-authz]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J. P.</span>, <span class="refAuthor">Vučinić, M.</span>, <span class="refAuthor">Fedrecheski, G.</span>, and <span class="refAuthor">M. Richardson</span>, <span class="refTitle">"Lightweight Authorization using Ephemeral Diffie-Hellman Over COSE (ELA)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lake-authz-06</span>, <time datetime="2025-10-20" class="refDate">20 October 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-authz-06">https://datatracker.ietf.org/doc/html/draft-ietf-lake-authz-06</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2986">[RFC2986]</dt>
        <dd>
<span class="refAuthor">Nystrom, M.</span> and <span class="refAuthor">B. Kaliski</span>, <span class="refTitle">"PKCS #10: Certification Request Syntax Specification Version 1.7"</span>, <span class="seriesInfo">RFC 2986</span>, <span class="seriesInfo">DOI 10.17487/RFC2986</span>, <time datetime="2000-11" class="refDate">November 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2986">https://www.rfc-editor.org/rfc/rfc2986</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5280">[RFC5280]</dt>
        <dd>
<span class="refAuthor">Cooper, D.</span>, <span class="refAuthor">Santesson, S.</span>, <span class="refAuthor">Farrell, S.</span>, <span class="refAuthor">Boeyen, S.</span>, <span class="refAuthor">Housley, R.</span>, and <span class="refAuthor">W. Polk</span>, <span class="refTitle">"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"</span>, <span class="seriesInfo">RFC 5280</span>, <span class="seriesInfo">DOI 10.17487/RFC5280</span>, <time datetime="2008-05" class="refDate">May 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5280">https://www.rfc-editor.org/rfc/rfc5280</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6960">[RFC6960]</dt>
        <dd>
<span class="refAuthor">Santesson, S.</span>, <span class="refAuthor">Myers, M.</span>, <span class="refAuthor">Ankney, R.</span>, <span class="refAuthor">Malpani, A.</span>, <span class="refAuthor">Galperin, S.</span>, and <span class="refAuthor">C. Adams</span>, <span class="refTitle">"X.509 Internet Public Key Infrastructure Online Certificate Status Protocol - OCSP"</span>, <span class="seriesInfo">RFC 6960</span>, <span class="seriesInfo">DOI 10.17487/RFC6960</span>, <time datetime="2013-06" class="refDate">June 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6960">https://www.rfc-editor.org/rfc/rfc6960</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9200">[RFC9200]</dt>
      <dd>
<span class="refAuthor">Seitz, L.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Authentication and Authorization for Constrained Environments Using the OAuth 2.0 Framework (ACE-OAuth)"</span>, <span class="seriesInfo">RFC 9200</span>, <span class="seriesInfo">DOI 10.17487/RFC9200</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9200">https://www.rfc-editor.org/rfc/rfc9200</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="sec-message-side-processing-m1-advanced">
<section id="appendix-A">
      <h2 id="name-foreseen-advanced-processin">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-foreseen-advanced-processin" class="section-name selfRef">Foreseen Advanced Processing of Incoming EDHOC message_1</a>
      </h2>
<p id="appendix-A-1">As mentioned in <a href="#sec-message-side-processing-m1" class="auto internal xref">Section 4.1</a>, future developments in EDHOC and in related external security applications might rely on an EAD item in EDHOC message_1 that specifies the authentication credential CRED associated with the Initiator (by value or by reference), as wrapped in a cryptographically protected "envelope".<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">In order to handle such a case, the processing of an incoming EDHOC message_1 as described in <a href="#sec-message-side-processing-m1" class="auto internal xref">Section 4.1</a> is extended with additional steps performed by the SPO.<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<p id="appendix-A-3">Such an extended side processing shares similarities with that of an incoming EDHOC message_2 or message_3 (see <a href="#sec-message-side-processing-m2-m3" class="auto internal xref">Section 4.3</a>). In particular, similarly to what is compiled in <a href="#sec-pre-verif-phase-1" class="auto internal xref">Section 4.3.1.1</a> and <a href="#sec-pre-verif-phase-2" class="auto internal xref">Section 4.3.1.2</a>, the SPO first checks whether expected EAD items are absent in message_X (see <a href="#sec-message-side-processing" class="auto internal xref">Section 4</a>), and then performs the following steps.<a href="#appendix-A-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-4.1">
          <p id="appendix-A-4.1.1">(0) The SPO checks the presence of an EAD item that specifies the authentication credential CRED associated with the Initiator (by value or by reference).<a href="#appendix-A-4.1.1" class="pilcrow">¶</a></p>
<p id="appendix-A-4.1.2">
If no such EAD item is found, the SPO moves to Step 12. Otherwise, the SPO moves to Step 1.<a href="#appendix-A-4.1.2" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-4.2">
          <p id="appendix-A-4.2.1">(1) The SPO determines CRED based on an EAD item retrieved at Step 0.<a href="#appendix-A-4.2.1" class="pilcrow">¶</a></p>
<p id="appendix-A-4.2.2">
The EAD item can specify CRED by value or by reference, including a URI or other external reference where CRED can be retrieved from.<a href="#appendix-A-4.2.2" class="pilcrow">¶</a></p>
<p id="appendix-A-4.2.3">
If CRED is already installed, the SPO moves to Step 2. Otherwise, the SPO moves to Step 3.<a href="#appendix-A-4.2.3" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-4.3">
          <p id="appendix-A-4.3.1">(2) The SPO determines if the stored CRED is currently trusted and valid, e.g., by verifying that CRED has not expired and has not been revoked.<a href="#appendix-A-4.3.1" class="pilcrow">¶</a></p>
<p id="appendix-A-4.3.2">
Performing such a validation might require the SPO to first process an EAD item included in message_1.<a href="#appendix-A-4.3.2" class="pilcrow">¶</a></p>
<p id="appendix-A-4.3.3">
In case CRED is determined to be valid, the SPO moves to Step 9. Otherwise, the SPO moves to Step 11.<a href="#appendix-A-4.3.3" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-4.4">
          <p id="appendix-A-4.4.1">(3) The SPO attempts to retrieve CRED via an EAD item considered at Step 1. Then, the SPO moves to Step 4.<a href="#appendix-A-4.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-4.5">
          <p id="appendix-A-4.5.1">(4) If the retrieval of CRED has succeeded, the SPO moves to Step 5. Otherwise, the SPO moves to Step 11.<a href="#appendix-A-4.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-4.6">
          <p id="appendix-A-4.6.1">(5) If the enforced trust policy for new authentication credentials is "NO-LEARNING" and P does not admit any exceptions that are acceptable to enforce for message_1 (see <a href="#sec-policy-no-learning" class="auto internal xref">Section 3.2</a>), the SPO moves to Step 11. Otherwise, the SPO moves to Step 6.<a href="#appendix-A-4.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-4.7">
          <p id="appendix-A-4.7.1">(6) If this step has been reached, the peer P is not already storing the retrieved CRED and, at the same time, it enforces either the trust policy "LEARNING" or the trust policy "NO-LEARNING" while also enforcing an exception acceptable for message_1 (see <a href="#sec-policy-no-learning" class="auto internal xref">Section 3.2</a>).<a href="#appendix-A-4.7.1" class="pilcrow">¶</a></p>
<p id="appendix-A-4.7.2">
Consistently, the SPO determines if CRED is currently valid, e.g., by verifying that CRED has not expired and has not been revoked.<a href="#appendix-A-4.7.2" class="pilcrow">¶</a></p>
<p id="appendix-A-4.7.3">
Validating CRED might require the SPO to first process an EAD item included in message_1.<a href="#appendix-A-4.7.3" class="pilcrow">¶</a></p>
<p id="appendix-A-4.7.4">
After successfully validating CRED, the peer P can typically consider CRED as ultimately trusted as well. However, there can be cases where P requires to obtain additional information before doing so.<a href="#appendix-A-4.7.4" class="pilcrow">¶</a></p>
<p id="appendix-A-4.7.5">
If such additional information can be retrieved from message_1 (e.g., from an EAD item included therein), then P uses it to assess if CRED is trusted. Otherwise, if such additional information is expected later on during the EDHOC session, it can be acceptable for P to consider CRED as provisionally trusted.<a href="#appendix-A-4.7.5" class="pilcrow">¶</a></p>
<p id="appendix-A-4.7.6">
After completing the validation and trust assessment of CRED, the SPO moves to Step 7.<a href="#appendix-A-4.7.6" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-4.8">
          <p id="appendix-A-4.8.1">(7) If CRED has been determined valid and (provisionally) trusted, the SPO moves to Step 8. Otherwise, the SPO moves to Step 11.<a href="#appendix-A-4.8.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-4.9">
          <p id="appendix-A-4.9.1">(8) The SPO stores CRED as a valid and (provisionally) trusted authentication credential associated with the other peer, together with corresponding authentication credential identifiers (see <a href="#sec-trust-models" class="auto internal xref">Section 3</a>). Then, the SPO moves to Step 9.<a href="#appendix-A-4.9.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-4.10">
          <p id="appendix-A-4.10.1">(9) The SPO checks if CRED is fine to use in the context of the ongoing EDHOC session, also depending on the specific identity of the other peer (see Sections <a href="https://rfc-editor.org/rfc/rfc9528#section-3.5" class="relref">3.5</a> and <a href="https://rfc-editor.org/rfc/rfc9528#appendix-D.2" class="relref">D.2</a> of <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>).<a href="#appendix-A-4.10.1" class="pilcrow">¶</a></p>
<p id="appendix-A-4.10.2">
If this is the case, the SPO moves to Step 10. Otherwise, the SPO moves to Step 11.<a href="#appendix-A-4.10.2" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-4.11">
          <p id="appendix-A-4.11.1">(10) P uses CRED as authentication credential associated with the other peer in the ongoing EDHOC session. Then, the SPO moves to Step 12.<a href="#appendix-A-4.11.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-4.12">
          <p id="appendix-A-4.12.1">(11) The SPO has not found a valid and (provisionally) trusted authentication credential associated with the other peer that can be used in the ongoing EDHOC session. Therefore, the EDHOC session with the other peer is aborted.<a href="#appendix-A-4.12.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-4.13">
          <p id="appendix-A-4.13.1">(12) The SPO processes any EAD item included in message_1 that has not already been processed.<a href="#appendix-A-4.13.1" class="pilcrow">¶</a></p>
<p id="appendix-A-4.13.2">
Once all such EAD items have been processed, the SPO transfers control back to EDHOC. When doing so, the SPO also provides EDHOC with any produced EAD items to include in the EAD field of the next outgoing EDHOC message.<a href="#appendix-A-4.13.2" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-5">The flowchart in <a href="#fig-flowchart-spo-low-level-m1-advanced" class="auto internal xref">Figure 6</a> shows the different steps taken for the advanced processing of an incoming EDHOC message_1 defined above.<a href="#appendix-A-5" class="pilcrow">¶</a></p>
<span id="name-processing-steps-for-edhoc-m"></span><div id="fig-flowchart-spo-low-level-m1-advanced">
<figure id="figure-6">
        <div id="appendix-A-6.1">
          <div class="alignCenter art-svg artwork" id="appendix-A-6.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="1936" width="576" viewBox="0 0 576 1936" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 8,400 L 8,1696" fill="none" stroke="black"></path>
              <path d="M 16,128 L 16,160" fill="none" stroke="black"></path>
              <path d="M 16,224 L 16,272" fill="none" stroke="black"></path>
              <path d="M 16,1872 L 16,1920" fill="none" stroke="black"></path>
              <path d="M 24,448 L 24,496" fill="none" stroke="black"></path>
              <path d="M 24,560 L 24,608" fill="none" stroke="black"></path>
              <path d="M 24,1584 L 24,1664" fill="none" stroke="black"></path>
              <path d="M 32,616 L 32,1576" fill="none" stroke="black"></path>
              <path d="M 56,864 L 56,928" fill="none" stroke="black"></path>
              <path d="M 56,1024 L 56,1120" fill="none" stroke="black"></path>
              <path d="M 56,1392 L 56,1520" fill="none" stroke="black"></path>
              <path d="M 64,672 L 64,752" fill="none" stroke="black"></path>
              <path d="M 88,1128 L 88,1384" fill="none" stroke="black"></path>
              <path d="M 88,1528 L 88,1576" fill="none" stroke="black"></path>
              <path d="M 88,1672 L 88,1744" fill="none" stroke="black"></path>
              <path d="M 88,1824 L 88,1864" fill="none" stroke="black"></path>
              <path d="M 96,80 L 96,120" fill="none" stroke="black"></path>
              <path d="M 96,168 L 96,216" fill="none" stroke="black"></path>
              <path d="M 96,280 L 96,304" fill="none" stroke="black"></path>
              <path d="M 96,384 L 96,440" fill="none" stroke="black"></path>
              <path d="M 96,504 L 96,552" fill="none" stroke="black"></path>
              <path d="M 96,616 L 96,664" fill="none" stroke="black"></path>
              <path d="M 96,760 L 96,856" fill="none" stroke="black"></path>
              <path d="M 96,936 L 96,1016" fill="none" stroke="black"></path>
              <path d="M 152,1872 L 152,1920" fill="none" stroke="black"></path>
              <path d="M 176,128 L 176,160" fill="none" stroke="black"></path>
              <path d="M 176,224 L 176,272" fill="none" stroke="black"></path>
              <path d="M 192,560 L 192,608" fill="none" stroke="black"></path>
              <path d="M 200,672 L 200,752" fill="none" stroke="black"></path>
              <path d="M 200,864 L 200,928" fill="none" stroke="black"></path>
              <path d="M 200,1024 L 200,1120" fill="none" stroke="black"></path>
              <path d="M 208,1392 L 208,1520" fill="none" stroke="black"></path>
              <path d="M 224,128 L 224,272" fill="none" stroke="black"></path>
              <path d="M 224,448 L 224,496" fill="none" stroke="black"></path>
              <path d="M 248,672 L 248,736" fill="none" stroke="black"></path>
              <path d="M 248,864 L 248,1056" fill="none" stroke="black"></path>
              <path d="M 248,1088 L 248,1424" fill="none" stroke="black"></path>
              <path d="M 296,800 L 296,856" fill="none" stroke="black"></path>
              <path d="M 296,1280 L 296,1328" fill="none" stroke="black"></path>
              <path d="M 296,1392 L 296,1520" fill="none" stroke="black"></path>
              <path d="M 320,1064 L 320,1272" fill="none" stroke="black"></path>
              <path d="M 320,1336 L 320,1384" fill="none" stroke="black"></path>
              <path d="M 344,864 L 344,1056" fill="none" stroke="black"></path>
              <path d="M 360,672 L 360,736" fill="none" stroke="black"></path>
              <path d="M 408,864 L 408,976" fill="none" stroke="black"></path>
              <path d="M 416,672 L 416,752" fill="none" stroke="black"></path>
              <path d="M 424,1152 L 424,1216" fill="none" stroke="black"></path>
              <path d="M 432,760 L 432,800" fill="none" stroke="black"></path>
              <path d="M 512,760 L 512,856" fill="none" stroke="black"></path>
              <path d="M 512,984 L 512,1144" fill="none" stroke="black"></path>
              <path d="M 512,1224 L 512,1272" fill="none" stroke="black"></path>
              <path d="M 520,1584 L 520,1664" fill="none" stroke="black"></path>
              <path d="M 528,672 L 528,752" fill="none" stroke="black"></path>
              <path d="M 552,864 L 552,976" fill="none" stroke="black"></path>
              <path d="M 552,1152 L 552,1216" fill="none" stroke="black"></path>
              <path d="M 552,1280 L 552,1328" fill="none" stroke="black"></path>
              <path d="M 552,1392 L 552,1520" fill="none" stroke="black"></path>
              <path d="M 568,400 L 568,1696" fill="none" stroke="black"></path>
              <path d="M 16,128 L 176,128" fill="none" stroke="black"></path>
              <path d="M 200,128 L 224,128" fill="none" stroke="black"></path>
              <path d="M 16,160 L 176,160" fill="none" stroke="black"></path>
              <path d="M 224,192 L 248,192" fill="none" stroke="black"></path>
              <path d="M 16,224 L 176,224" fill="none" stroke="black"></path>
              <path d="M 16,272 L 176,272" fill="none" stroke="black"></path>
              <path d="M 200,272 L 224,272" fill="none" stroke="black"></path>
              <path d="M 8,400 L 88,400" fill="none" stroke="black"></path>
              <path d="M 104,400 L 568,400" fill="none" stroke="black"></path>
              <path d="M 24,448 L 224,448" fill="none" stroke="black"></path>
              <path d="M 24,496 L 224,496" fill="none" stroke="black"></path>
              <path d="M 24,560 L 192,560" fill="none" stroke="black"></path>
              <path d="M 24,608 L 192,608" fill="none" stroke="black"></path>
              <path d="M 64,672 L 200,672" fill="none" stroke="black"></path>
              <path d="M 248,672 L 360,672" fill="none" stroke="black"></path>
              <path d="M 416,672 L 528,672" fill="none" stroke="black"></path>
              <path d="M 208,704 L 240,704" fill="none" stroke="black"></path>
              <path d="M 368,704 L 408,704" fill="none" stroke="black"></path>
              <path d="M 248,736 L 360,736" fill="none" stroke="black"></path>
              <path d="M 64,752 L 200,752" fill="none" stroke="black"></path>
              <path d="M 416,752 L 528,752" fill="none" stroke="black"></path>
              <path d="M 296,800 L 432,800" fill="none" stroke="black"></path>
              <path d="M 56,864 L 200,864" fill="none" stroke="black"></path>
              <path d="M 248,864 L 344,864" fill="none" stroke="black"></path>
              <path d="M 408,864 L 552,864" fill="none" stroke="black"></path>
              <path d="M 208,880 L 240,880" fill="none" stroke="black"></path>
              <path d="M 352,880 L 400,880" fill="none" stroke="black"></path>
              <path d="M 56,928 L 200,928" fill="none" stroke="black"></path>
              <path d="M 408,976 L 552,976" fill="none" stroke="black"></path>
              <path d="M 56,1024 L 200,1024" fill="none" stroke="black"></path>
              <path d="M 208,1040 L 240,1040" fill="none" stroke="black"></path>
              <path d="M 248,1056 L 344,1056" fill="none" stroke="black"></path>
              <path d="M 208,1088 L 248,1088" fill="none" stroke="black"></path>
              <path d="M 56,1120 L 200,1120" fill="none" stroke="black"></path>
              <path d="M 424,1152 L 552,1152" fill="none" stroke="black"></path>
              <path d="M 424,1216 L 552,1216" fill="none" stroke="black"></path>
              <path d="M 296,1280 L 552,1280" fill="none" stroke="black"></path>
              <path d="M 296,1328 L 552,1328" fill="none" stroke="black"></path>
              <path d="M 56,1392 L 208,1392" fill="none" stroke="black"></path>
              <path d="M 296,1392 L 552,1392" fill="none" stroke="black"></path>
              <path d="M 248,1424 L 288,1424" fill="none" stroke="black"></path>
              <path d="M 56,1520 L 208,1520" fill="none" stroke="black"></path>
              <path d="M 296,1520 L 552,1520" fill="none" stroke="black"></path>
              <path d="M 24,1584 L 520,1584" fill="none" stroke="black"></path>
              <path d="M 24,1664 L 520,1664" fill="none" stroke="black"></path>
              <path d="M 8,1696 L 80,1696" fill="none" stroke="black"></path>
              <path d="M 96,1696 L 568,1696" fill="none" stroke="black"></path>
              <path d="M 16,1872 L 152,1872" fill="none" stroke="black"></path>
              <path d="M 16,1920 L 152,1920" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="520,1272 508,1266.4 508,1277.6" fill="black" transform="rotate(90,512,1272)"></polygon>
              <polygon class="arrowhead" points="520,1144 508,1138.4 508,1149.6" fill="black" transform="rotate(90,512,1144)"></polygon>
              <polygon class="arrowhead" points="520,856 508,850.4 508,861.6" fill="black" transform="rotate(90,512,856)"></polygon>
              <polygon class="arrowhead" points="416,704 404,698.4 404,709.6" fill="black" transform="rotate(0,408,704)"></polygon>
              <polygon class="arrowhead" points="360,880 348,874.4 348,885.6" fill="black" transform="rotate(180,352,880)"></polygon>
              <polygon class="arrowhead" points="328,1384 316,1378.4 316,1389.6" fill="black" transform="rotate(90,320,1384)"></polygon>
              <polygon class="arrowhead" points="328,1064 316,1058.4 316,1069.6" fill="black" transform="rotate(270,320,1064)"></polygon>
              <polygon class="arrowhead" points="304,856 292,850.4 292,861.6" fill="black" transform="rotate(90,296,856)"></polygon>
              <polygon class="arrowhead" points="248,1040 236,1034.4 236,1045.6" fill="black" transform="rotate(0,240,1040)"></polygon>
              <polygon class="arrowhead" points="248,880 236,874.4 236,885.6" fill="black" transform="rotate(0,240,880)"></polygon>
              <polygon class="arrowhead" points="248,704 236,698.4 236,709.6" fill="black" transform="rotate(0,240,704)"></polygon>
              <polygon class="arrowhead" points="216,1088 204,1082.4 204,1093.6" fill="black" transform="rotate(180,208,1088)"></polygon>
              <polygon class="arrowhead" points="104,1016 92,1010.4 92,1021.6" fill="black" transform="rotate(90,96,1016)"></polygon>
              <polygon class="arrowhead" points="104,856 92,850.4 92,861.6" fill="black" transform="rotate(90,96,856)"></polygon>
              <polygon class="arrowhead" points="104,664 92,658.4 92,669.6" fill="black" transform="rotate(90,96,664)"></polygon>
              <polygon class="arrowhead" points="104,552 92,546.4 92,557.6" fill="black" transform="rotate(90,96,552)"></polygon>
              <polygon class="arrowhead" points="104,216 92,210.4 92,221.6" fill="black" transform="rotate(90,96,216)"></polygon>
              <polygon class="arrowhead" points="104,120 92,114.4 92,125.6" fill="black" transform="rotate(90,96,120)"></polygon>
              <polygon class="arrowhead" points="96,1864 84,1858.4 84,1869.6" fill="black" transform="rotate(90,88,1864)"></polygon>
              <polygon class="arrowhead" points="96,1744 84,1738.4 84,1749.6" fill="black" transform="rotate(90,88,1744)"></polygon>
              <polygon class="arrowhead" points="96,1576 84,1570.4 84,1581.6" fill="black" transform="rotate(90,88,1576)"></polygon>
              <polygon class="arrowhead" points="96,1384 84,1378.4 84,1389.6" fill="black" transform="rotate(90,88,1384)"></polygon>
              <polygon class="arrowhead" points="40,1576 28,1570.4 28,1581.6" fill="black" transform="rotate(90,32,1576)"></polygon>
              <g class="text">
                <text x="52" y="36">Incoming</text>
                <text x="40" y="52">EDHOC</text>
                <text x="104" y="52">message_1</text>
                <text x="52" y="148">Decode</text>
                <text x="120" y="148">message_1</text>
                <text x="280" y="196">(Core</text>
                <text x="328" y="196">EDHOC</text>
                <text x="400" y="196">Processing)</text>
                <text x="60" y="244">Accepted</text>
                <text x="132" y="244">selected</text>
                <text x="52" y="260">cipher</text>
                <text x="104" y="260">suite</text>
                <text x="40" y="340">Control</text>
                <text x="120" y="340">transferred</text>
                <text x="180" y="340">to</text>
                <text x="24" y="356">the</text>
                <text x="100" y="356">side-processor</text>
                <text x="188" y="356">object</text>
                <text x="420" y="420">Side</text>
                <text x="484" y="420">processing</text>
                <text x="56" y="468">Check</text>
                <text x="112" y="468">whether</text>
                <text x="180" y="468">expected</text>
                <text x="48" y="484">EAD</text>
                <text x="88" y="484">items</text>
                <text x="128" y="484">are</text>
                <text x="172" y="484">absent</text>
                <text x="44" y="580">0.</text>
                <text x="76" y="580">Does</text>
                <text x="108" y="580">an</text>
                <text x="136" y="580">EAD</text>
                <text x="52" y="596">item</text>
                <text x="104" y="596">specify</text>
                <text x="160" y="596">CRED?</text>
                <text x="52" y="644">NO</text>
                <text x="120" y="644">YES</text>
                <text x="84" y="692">1.</text>
                <text x="116" y="692">Does</text>
                <text x="148" y="692">an</text>
                <text x="176" y="692">EAD</text>
                <text x="220" y="692">NO</text>
                <text x="268" y="692">3.</text>
                <text x="316" y="692">Retrieve</text>
                <text x="436" y="692">4.</text>
                <text x="460" y="692">Is</text>
                <text x="488" y="692">the</text>
                <text x="92" y="708">item</text>
                <text x="136" y="708">point</text>
                <text x="172" y="708">to</text>
                <text x="276" y="708">CRED</text>
                <text x="312" y="708">via</text>
                <text x="464" y="708">retrieval</text>
                <text x="84" y="724">an</text>
                <text x="128" y="724">already</text>
                <text x="268" y="724">an</text>
                <text x="296" y="724">EAD</text>
                <text x="332" y="724">item</text>
                <text x="436" y="724">of</text>
                <text x="468" y="724">CRED</text>
                <text x="100" y="740">stored</text>
                <text x="152" y="740">CRED?</text>
                <text x="472" y="740">successful?</text>
                <text x="452" y="788">NO</text>
                <text x="536" y="788">YES</text>
                <text x="120" y="836">YES</text>
                <text x="220" y="868">NO</text>
                <text x="384" y="868">YES</text>
                <text x="76" y="884">2.</text>
                <text x="100" y="884">Is</text>
                <text x="132" y="884">this</text>
                <text x="172" y="884">CRED</text>
                <text x="272" y="884">11.</text>
                <text x="312" y="884">Abort</text>
                <text x="428" y="884">5.</text>
                <text x="452" y="884">Is</text>
                <text x="480" y="884">the</text>
                <text x="520" y="884">trust</text>
                <text x="88" y="900">still</text>
                <text x="136" y="900">valid</text>
                <text x="176" y="900">and</text>
                <text x="272" y="900">the</text>
                <text x="312" y="900">EDHOC</text>
                <text x="444" y="900">policy</text>
                <text x="492" y="900">used</text>
                <text x="100" y="916">trusted?</text>
                <text x="288" y="916">session</text>
                <text x="476" y="916">"NO-LEARNING",</text>
                <text x="448" y="932">without</text>
                <text x="496" y="932">any</text>
                <text x="460" y="948">acceptable</text>
                <text x="464" y="964">exceptions?</text>
                <text x="120" y="996">YES</text>
                <text x="404" y="1012">Here</text>
                <text x="440" y="1012">the</text>
                <text x="480" y="1012">trust</text>
                <text x="532" y="1012">NO</text>
                <text x="220" y="1028">NO</text>
                <text x="412" y="1028">policy</text>
                <text x="460" y="1028">used</text>
                <text x="492" y="1028">is</text>
                <text x="76" y="1044">9.</text>
                <text x="100" y="1044">Is</text>
                <text x="132" y="1044">this</text>
                <text x="172" y="1044">CRED</text>
                <text x="432" y="1044">"LEARNING",</text>
                <text x="492" y="1044">or</text>
                <text x="84" y="1060">good</text>
                <text x="116" y="1060">to</text>
                <text x="144" y="1060">use</text>
                <text x="172" y="1060">in</text>
                <text x="440" y="1060">"NO-LEARNING"</text>
                <text x="80" y="1076">the</text>
                <text x="128" y="1076">context</text>
                <text x="172" y="1076">of</text>
                <text x="420" y="1076">together</text>
                <text x="476" y="1076">with</text>
                <text x="84" y="1092">this</text>
                <text x="128" y="1092">EDHOC</text>
                <text x="396" y="1092">an</text>
                <text x="452" y="1092">overriding</text>
                <text x="100" y="1108">session?</text>
                <text x="424" y="1108">exception</text>
                <text x="444" y="1172">6.</text>
                <text x="484" y="1172">Assess</text>
                <text x="524" y="1172">if</text>
                <text x="452" y="1188">CRED</text>
                <text x="484" y="1188">is</text>
                <text x="520" y="1188">valid</text>
                <text x="448" y="1204">and</text>
                <text x="496" y="1204">trusted</text>
                <text x="112" y="1252">YES</text>
                <text x="340" y="1252">NO</text>
                <text x="316" y="1300">7.</text>
                <text x="340" y="1300">Is</text>
                <text x="372" y="1300">CRED</text>
                <text x="416" y="1300">valid</text>
                <text x="456" y="1300">and</text>
                <text x="368" y="1316">(provisionally)</text>
                <text x="468" y="1316">trusted?</text>
                <text x="344" y="1364">YES</text>
                <text x="80" y="1412">10.</text>
                <text x="132" y="1412">Continue</text>
                <text x="180" y="1412">by</text>
                <text x="316" y="1412">8.</text>
                <text x="352" y="1412">Store</text>
                <text x="396" y="1412">CRED</text>
                <text x="428" y="1412">as</text>
                <text x="464" y="1412">valid</text>
                <text x="504" y="1412">and</text>
                <text x="112" y="1428">considering</text>
                <text x="180" y="1428">this</text>
                <text x="368" y="1428">(provisionally)</text>
                <text x="468" y="1428">trusted.</text>
                <text x="84" y="1444">CRED</text>
                <text x="116" y="1444">as</text>
                <text x="144" y="1444">the</text>
                <text x="124" y="1460">authentication</text>
                <text x="324" y="1460">Pair</text>
                <text x="364" y="1460">CRED</text>
                <text x="404" y="1460">with</text>
                <text x="468" y="1460">consistent</text>
                <text x="108" y="1476">credential</text>
                <text x="348" y="1476">credential</text>
                <text x="444" y="1476">identifiers,</text>
                <text x="512" y="1476">for</text>
                <text x="108" y="1492">associated</text>
                <text x="172" y="1492">with</text>
                <text x="324" y="1492">each</text>
                <text x="384" y="1492">supported</text>
                <text x="444" y="1492">type</text>
                <text x="476" y="1492">of</text>
                <text x="80" y="1508">the</text>
                <text x="120" y="1508">other</text>
                <text x="164" y="1508">peer</text>
                <text x="348" y="1508">credential</text>
                <text x="440" y="1508">identifier.</text>
                <text x="48" y="1604">12.</text>
                <text x="96" y="1604">Process</text>
                <text x="144" y="1604">the</text>
                <text x="176" y="1604">EAD</text>
                <text x="216" y="1604">items</text>
                <text x="260" y="1604">that</text>
                <text x="300" y="1604">have</text>
                <text x="336" y="1604">not</text>
                <text x="372" y="1604">been</text>
                <text x="432" y="1604">processed</text>
                <text x="492" y="1604">yet.</text>
                <text x="52" y="1636">Make</text>
                <text x="88" y="1636">all</text>
                <text x="120" y="1636">the</text>
                <text x="168" y="1636">results</text>
                <text x="212" y="1636">of</text>
                <text x="240" y="1636">the</text>
                <text x="272" y="1636">EAD</text>
                <text x="332" y="1636">processing</text>
                <text x="416" y="1636">available</text>
                <text x="468" y="1636">to</text>
                <text x="56" y="1652">build</text>
                <text x="96" y="1652">the</text>
                <text x="132" y="1652">next</text>
                <text x="176" y="1652">EDHOC</text>
                <text x="236" y="1652">message.</text>
                <text x="40" y="1780">Control</text>
                <text x="120" y="1780">transferred</text>
                <text x="188" y="1780">back</text>
                <text x="20" y="1796">to</text>
                <text x="48" y="1796">the</text>
                <text x="84" y="1796">core</text>
                <text x="128" y="1796">EDHOC</text>
                <text x="196" y="1796">processing</text>
                <text x="56" y="1892">Advance</text>
                <text x="104" y="1892">the</text>
                <text x="184" y="1892">(Core</text>
                <text x="232" y="1892">EDHOC</text>
                <text x="304" y="1892">processing)</text>
                <text x="60" y="1908">protocol</text>
                <text x="120" y="1908">state</text>
              </g>
            </svg><a href="#appendix-A-6.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-processing-steps-for-edhoc-m" class="selfRef">Processing Steps for EDHOC message_1.</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="sec-document-updates">
<section id="appendix-B">
      <h2 id="name-document-updates">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-document-updates" class="section-name selfRef">Document Updates</a>
      </h2>
<p id="appendix-B-1">This section is to be removed before publishing as an RFC.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<div id="sec-05-06">
<section id="appendix-B.1">
        <h3 id="name-version-05-to-06">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-version-05-to-06" class="section-name selfRef">Version -05 to -06</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-B.1-1.1">
            <p id="appendix-B.1-1.1.1">Generalized trust assessment of authentication credentials.<a href="#appendix-B.1-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-1.2">
            <p id="appendix-B.1-1.2.1">Revised discussion on the ELA procedure, based on upcoming updates expected in version -07 of draft-ietf-lake-authz.<a href="#appendix-B.1-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-1.3">
            <p id="appendix-B.1-1.3.1">Added side-processing check about the absence of expected EAD items in incoming EDHOC messages.<a href="#appendix-B.1-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-1.4">
            <p id="appendix-B.1-1.4.1">Added "Operational Considerations" section.<a href="#appendix-B.1-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-1.5">
            <p id="appendix-B.1-1.5.1">Editorial fixes and improvements.<a href="#appendix-B.1-1.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-04-05">
<section id="appendix-B.2">
        <h3 id="name-version-04-to-05">
<a href="#appendix-B.2" class="section-number selfRef">B.2. </a><a href="#name-version-04-to-05" class="section-name selfRef">Version -04 to -05</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-B.2-1.1">
            <p id="appendix-B.2-1.1.1">Minor clarifications.<a href="#appendix-B.2-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-1.2">
            <p id="appendix-B.2-1.2.1">Editorial fixes and improvements.<a href="#appendix-B.2-1.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-03-04">
<section id="appendix-B.3">
        <h3 id="name-version-03-to-04">
<a href="#appendix-B.3" class="section-number selfRef">B.3. </a><a href="#name-version-03-to-04" class="section-name selfRef">Version -03 to -04</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-B.3-1.1">
            <p id="appendix-B.3-1.1.1">Clarified and re-positioned exceptions to NO-LEARNING policy.<a href="#appendix-B.3-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-1.2">
            <p id="appendix-B.3-1.2.1">Added security considerations.<a href="#appendix-B.3-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-1.3">
            <p id="appendix-B.3-1.3.1">Appendix on foreseen advanced processing of incoming EDHOC message_1.<a href="#appendix-B.3-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-1.4">
            <p id="appendix-B.3-1.4.1">Clarifications and editorial improvements.<a href="#appendix-B.3-1.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-02-03">
<section id="appendix-B.4">
        <h3 id="name-version-02-to-03">
<a href="#appendix-B.4" class="section-number selfRef">B.4. </a><a href="#name-version-02-to-03" class="section-name selfRef">Version -02 to -03</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-B.4-1.1">
            <p id="appendix-B.4-1.1.1">Consistent use of "trust policy" instead of "trust model".<a href="#appendix-B.4-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.4-1.2">
            <p id="appendix-B.4-1.2.1">More modular presentation of trust policies and their enforcement.<a href="#appendix-B.4-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.4-1.3">
            <p id="appendix-B.4-1.3.1">Alignment with use of EDHOC in the EDHOC and OSCORE profile of ACE.<a href="#appendix-B.4-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.4-1.4">
            <p id="appendix-B.4-1.4.1">Note on follow-up actions for the application after EDHOC completion.<a href="#appendix-B.4-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.4-1.5">
            <p id="appendix-B.4-1.5.1">Removed moot section on special handling when using the EDHOC and OSCORE profile of ACE.<a href="#appendix-B.4-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.4-1.6">
            <p id="appendix-B.4-1.6.1">Consistency checks of authentication credentials from ID_CRED and EAD items.<a href="#appendix-B.4-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.4-1.7">
            <p id="appendix-B.4-1.7.1">Updated reference.<a href="#appendix-B.4-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.4-1.8">
            <p id="appendix-B.4-1.8.1">Clarifications and editorial improvements.<a href="#appendix-B.4-1.8.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-01-02">
<section id="appendix-B.5">
        <h3 id="name-version-01-to-02">
<a href="#appendix-B.5" class="section-number selfRef">B.5. </a><a href="#name-version-01-to-02" class="section-name selfRef">Version -01 to -02</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-B.5-1.1">
            <p id="appendix-B.5-1.1.1">Improved content on the EDHOC and OSCORE profile of ACE.<a href="#appendix-B.5-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.5-1.2">
            <p id="appendix-B.5-1.2.1">Admit situation-specific exceptions to the "NO-LEARNING" policy.<a href="#appendix-B.5-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.5-1.3">
            <p id="appendix-B.5-1.3.1">Using the EDHOC and OSCORE profile of ACE with the "NO-LEARNING" policy.<a href="#appendix-B.5-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.5-1.4">
            <p id="appendix-B.5-1.4.1">Revised guidelines on using EDHOC with CoAP and Block-wise.<a href="#appendix-B.5-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.5-1.5">
            <p id="appendix-B.5-1.5.1">Editorial improvements.<a href="#appendix-B.5-1.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-00-01">
<section id="appendix-B.6">
        <h3 id="name-version-00-to-01">
<a href="#appendix-B.6" class="section-number selfRef">B.6. </a><a href="#name-version-00-to-01" class="section-name selfRef">Version -00 to -01</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-B.6-1.1">
            <p id="appendix-B.6-1.1.1">Added considerations on trust policies when using the EDHOC and OSCORE profile of the ACE framework.<a href="#appendix-B.6-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.6-1.2">
            <p id="appendix-B.6-1.2.1">Placeholder section on special processing when using the EDHOC and OSCORE profile of the ACE framework.<a href="#appendix-B.6-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.6-1.3">
            <p id="appendix-B.6-1.3.1">Added considerations on using EDHOC with CoAP and Block-wise.<a href="#appendix-B.6-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.6-1.4">
            <p id="appendix-B.6-1.4.1">Editorial improvements.<a href="#appendix-B.6-1.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-C">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-C-1">The author sincerely thanks <span class="contact-name">Christian Amsüss</span>, <span class="contact-name">Geovane Fedrecheski</span>, <span class="contact-name">Rikard Höglund</span>, <span class="contact-name">John Preuß Mattsson</span>, <span class="contact-name">Göran Selander</span>, and <span class="contact-name">Mališa Vučinić</span> for their comments and feedback.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<p id="appendix-C-2">The work on this document has been partly supported by the Sweden's Innovation Agency VINNOVA and the Celtic-Next project CYPRESS.<a href="#appendix-C-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-D">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Marco Tiloca</span></div>
<div dir="auto" class="left"><span class="org">RISE AB</span></div>
<div dir="auto" class="left"><span class="street-address">Isafjordsgatan 22</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">16440 Stockholm</span> <span class="locality">Kista</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:marco.tiloca@ri.se" class="email">marco.tiloca@ri.se</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
